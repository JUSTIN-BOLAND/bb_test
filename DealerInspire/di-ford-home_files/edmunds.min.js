function EdmundsAPI(token){function translateDetailsToRows(data){var table=[],labels={insurance:"Insurance",maintenance:"Maintenance",repairs:"Repairs",taxandfees:"Taxes & Fees",financing:"Financing",depreciation:"Depreciation",fuel:"Fuel",taxcredit:"Tax Credit"};for(var categoryName in data){var category=data[categoryName],row=[];"object"==typeof category?(row=category.values,row.push(category.total)):row=[category,category,category,category,category,category],row.unshift(labels[categoryName]),table.push(row)}for(var bottomRow=["Edmunds True Cost to Own&reg;"],i=1;i<=6;i++){var total=0;for(var rowIndex in table)total+=table[rowIndex][i];bottomRow.push(total)}return table.push(bottomRow),table}var self=this;self.token=token,self.helpers={},self._http=function(url){return url=url+"?fmt=json&api_key="+self.token,jQuery.get(url)},self._option=function(options,key,defaultValue){return"undefined"!=typeof options[key]?encodeURIComponent(options[key]):defaultValue},self.vinLookup=function(vin,success,failure){var url="https://api.edmunds.com/api/vehicle/v2/vins/"+vin,promise=self._http(url);promise.done(function(data){success&&success(data)}),promise.fail(function(){failure&&failure()})},self.getStyleFromVin=function(vin,success,failure){self.vinLookup(vin,function(data){data.years[0].styles[0].id;success&&success(data.years[0].styles[0].id)},function(){failure&&failure()})},self.getStyle=function(options,success,failure){var make=self._option(options,"make"),model=self._option(options,"model"),year=self._option(options,"year"),url="https://api.edmunds.com/api/vehicle/v2/"+make+"/"+model+"/"+year+"/styles",promise=self._http(url);promise.done(function(data){var trims=jQuery.grep(data.styles,function(element,index){return element.trim===options.trim}),style=trims.length>0?trims[0]:{};success&&success(style)}),promise.fail(function(){failure&&failure()})},self.helpers.getStateFromZip=function(zip,success,failure){return 5!=zip.length?(failure("invalid_zip"),!1):void jQuery.get("http://maps.googleapis.com/maps/api/geocode/json?address="+zip).done(function(data){var addressComponents=data.results[0].address_components,zipCode=!1,state=!1;for(var index in addressComponents){var component=addressComponents[index];"postal_code"==component.types[0]&&(zipCode=component.short_name),"administrative_area_level_1"==component.types[0]&&(state=component.short_name)}zipCode&&state?success(zipCode,state):failure("invalid_zip")})},self.priceCostToOwn=function(options,success,failure){var condition=self._option(options,"condition"),style=self._option(options,"style"),zip=self._option(options,"zip");if(!condition)return void(failure&&failure());var url="https://api.edmunds.com/v1/api/tco/"+condition+"truecosttoownbystyleidandzip/"+style+"/"+zip,promise=self._http(url);promise.done(function(data){success&&success(data.value)}),promise.fail(function(){failure&&failure()})},self.totalCashPrice=function(options,success,failure){var condition=self._option(options,"condition"),style=self._option(options,"style"),zip=self._option(options,"zip");if(!condition)return void(failure&&failure());var url="https://api.edmunds.com/v1/api/tco/"+condition+"totalcashpricebystyleidandzip/"+style+"/"+zip,promise=self._http(url);promise.done(function(data){success&&success(data.value)}),promise.fail(function(){failure&&failure()})},self.totalCostToOwnDetails=function(options,success,failure){var condition=self._option(options,"condition"),style=self._option(options,"style"),zip=self._option(options,"zip"),state=self._option(options,"state");if(!condition)return void(failure&&failure());var url="https://api.edmunds.com/api/tco/v1/details/all"+condition+"tcobystyleidzipandstate/"+style+"/"+zip+"/"+state,promise=self._http(url);promise.done(function(data){var details=jQuery.map(data,function(element,index){return{label:index,value:element.total}});success&&success(details,translateDetailsToRows(data))}),promise.fail(function(){failure&&failure()})}}