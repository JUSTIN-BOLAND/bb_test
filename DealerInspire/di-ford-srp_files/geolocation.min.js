var DIGeoLocation={ignoreRequestCount:2,ignoreRequestCookieDurationInMinutes:10080,ignoreRequestCookieDurationInMinutesWhenDeviceDoesntSupportLocations:525600,ignoreRequestCookieKey:"diGeolocationIgnoreData",ignoreRequestData:{currentRequestCount:0,createdAt:jQuery.now()},cookieDurationInMinutes:15,updateDurationInMinutes:5,isConsoleLogEmitting:!1,isAjaxEnabled:!1,isSupported:!0,isClickyIntegrationEnabled:!0,isClickyCustomTimerOverridden:!0,clickyCustomTimerOverrideValue:200,positionOptions:{enableHighAccuracy:!0,timeout:3e4},cookieKey:"diGeolocationCookie",userLocationData:{isUserLocationDataAvailable:!1,isRejectedByBrowser:!1,latitude:!1,longitude:!1,accuracy:!1,altitude:!1,altitudeAccuracy:!1,heading:!1,speed:!1,timestamp:!1},locationPromise:new jQuery.Deferred,init:function(){DIGeoLocation.showAdminBar("Loc: Init...");var a=DIGeoLocation.readCookie(DIGeoLocation.cookieKey),b=DIGeoLocation.readCookie(DIGeoLocation.ignoreRequestCookieKey);if(b){DIGeoLocation.ignoreRequestData=JSON.parse(b);var c=Math.floor((jQuery.now()-DIGeoLocation.ignoreRequestData.createdAt)/60/1e3);c>=DIGeoLocation.ignoreRequestCookieDurationInMinutes&&(DIGeoLocation.ignoreRequestData.currentRequestCount=0,DIGeoLocation.ignoreRequestData.createdAt=jQuery.now(),DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutes))}else DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutes);if(a){DIGeoLocation.userLocationData=JSON.parse(DIGeoLocation.readCookie(DIGeoLocation.cookieKey)),DIGeoLocation.locationPromise.resolve(DIGeoLocation.userLocationData);var c=Math.floor((jQuery.now()-DIGeoLocation.userLocationData.createdAt)/60/1e3);c<DIGeoLocation.updateDurationInMinutes?(DIGeoLocation.console_log("cookie data found and is not yet expired. No further geolocation action is needed."),DIGeoLocation.doClickyIntegration(DIGeoLocation.isClickyIntegrationEnabled,DIGeoLocation.isClickyCustomTimerOverridden,DIGeoLocation.clickyCustomTimerOverrideValue),DIGeoLocation.showAdminBar("Loc: "+DIGeoLocation.userLocationData.latitude.toFixed(5)+","+DIGeoLocation.userLocationData.longitude.toFixed(5))):(DIGeoLocation.console_log("Cookie data found but in need of update. Requesting Update..."),1!=DIGeoLocation.userLocationData.isRejectedByBrowser?DIGeoLocation.requestGlobalLocationFromBrowser():DIGeoLocation.showAdminBar("Loc: Rejected"))}else DIGeoLocation.console_log("DI GeoLocation cookie is not set or is expired. Requesting geolocation data."),DIGeoLocation.exceededRequestCount()?(DIGeoLocation.showAdminBar("Loc: Ignored"),DIGeoLocation.console_log("Exceeded GeoLocation request count. No longer requesting information from user.")):DIGeoLocation.requestGlobalLocationFromBrowser();DIGeoLocation.locationPromise.done(function(a){jQuery(document).trigger("di_geolocation_finished",{status:"OK",response:a})}).fail(function(a){jQuery(document).trigger("di_geolocation_finished",{status:a.code.toString(),response:"Error: "+a.code})})},console_log:function(a){if("undefined"==typeof DIGeoLocation.isConsoleLogEmitting||0==DIGeoLocation.isConsoleLogEmitting)return!1;var b=!0;"undefined"!=typeof console&&"undefined"!=typeof console.log||(console={},b?console.log=function(a){alert(a)}:console.log=function(){}),console.log(a)},showAdminBar:function(a){jQuery(document).ready(function(){jQuery("#wp-admin-bar-di-geolocation_location-available span.geolocation").text(a)})},exceededRequestCount:function(){return DIGeoLocation.ignoreRequestData.currentRequestCount>=DIGeoLocation.ignoreRequestCount},stillLoading:function(){return 0!=DIGeoLocation.isSupported&&(!DIGeoLocation.exceededRequestCount()&&0==DIGeoLocation.userLocationData.isRejectedByBrowser&&0==DIGeoLocation.userLocationData.isUserLocationDataAvailable)},requestGlobalLocationFromBrowser:function(){DIGeoLocation.showAdminBar("Loc: Requesting..."),DIGeoLocation.ignoreRequestData.currentRequestCount+=1,DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutes),navigator.geolocation?navigator.geolocation.getCurrentPosition(DIGeoLocation.handleLocationSuccessData,DIGeoLocation.handleLocationError,DIGeoLocation.positionOptions):(DIGeoLocation.isSupported=!1,DIGeoLocation.console_log("Error: Your browser doesn't support geolocation."))},handleLocationError:function(a){switch(a.code){case 1:DIGeoLocation.console_log("GeoLocation failed or denied by browser"),DIGeoLocation.showAdminBar("Loc: Failed"),DIGeoLocation.userLocationData.isRejectedByBrowser=!0,DIGeoLocation.ignoreRequestData.currentRequestCount=DIGeoLocation.ignoreRequestCount,DIGeoLocation.ignoreRequestData.createdAt=jQuery.now(),DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutes);break;case 2:DIGeoLocation.console_log("GeoLocation is not supported by the browser"),DIGeoLocation.showAdminBar("Loc: Unsupported"),DIGeoLocation.userLocationData.isRejectedByBrowser=!0,DIGeoLocation.ignoreRequestData.currentRequestCount=DIGeoLocation.ignoreRequestCount,DIGeoLocation.ignoreRequestData.createdAt=jQuery.now(),DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutesWhenDeviceDoesntSupportLocations);break;case 3:DIGeoLocation.console_log("DIGeolocation - timeout received when attempting to get geolocation"),DIGeoLocation.showAdminBar("Loc: Timeout"),DIGeoLocation.userLocationData.isRejectedByBrowser=!0,DIGeoLocation.ignoreRequestData.currentRequestCount=DIGeoLocation.ignoreRequestCount,DIGeoLocation.ignoreRequestData.createdAt=jQuery.now(),DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),180);break;default:DIGeoLocation.showAdminBar("Loc: Error"),DIGeoLocation.console_log("DIGeolocation Other Error requesting location: "+a.code)}DIGeoLocation.locationPromise.reject(a)},handleLocationSuccessData:function(a){DIGeoLocation.ignoreRequestData.currentRequestCount=0,DIGeoLocation.createCookie(DIGeoLocation.ignoreRequestCookieKey,JSON.stringify(DIGeoLocation.ignoreRequestData),DIGeoLocation.ignoreRequestCookieDurationInMinutes),DIGeoLocation.userLocationData={createdAt:jQuery.now(),isUserLocationDataAvailable:!0,isRejectedByBrowser:!1,latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,altitude:a.coords.altitude,altitudeAccuracy:a.coords.altitudeAccuracy,heading:a.coords.heading,speed:a.coords.speed,timestamp:a.timestamp};var b=ajax_geolocation_params.ajax_url;DIGeoLocation.console_log("setting geolocation cookie for "+DIGeoLocation.cookieDurationInMinutes+" minutes."),DIGeoLocation.createCookie(DIGeoLocation.cookieKey,JSON.stringify(DIGeoLocation.userLocationData),DIGeoLocation.cookieDurationInMinutes),"undefined"==typeof DIGeoLocation.isAjaxEnabled||DIGeoLocation.isAjaxEnabled===!1?DIGeoLocation.console_log("Geolocation - ajax is disabled. Storing as cookie only."):(DIGeoLocation.console_log("Geolocation - ajax is enabled. Storing as cookie AND submitting via AJAX."),jQuery.ajax({type:"POST",url:b,dataType:"script",data:{action:"di_geolocation_filter",userLocation:DIGeoLocation.userLocationData,window_location_href:window.location.href},beforeSend:function(){console_log(locationData)},success:function(a){a.callback()},error:function(){$("#CloseEventsRow .events-closest").html("<p>Sorry, unable to retrieve the nearest locations at this time.</p>")}})),DIGeoLocation.doClickyIntegration(DIGeoLocation.isClickyIntegrationEnabled,DIGeoLocation.isClickyCustomTimerOverridden,DIGeoLocation.clickyCustomTimerOverrideValue),DIGeoLocation.showAdminBar("Loc: "+DIGeoLocation.userLocationData.latitude.toFixed(5)+","+DIGeoLocation.userLocationData.longitude.toFixed(5)),DIGeoLocation.locationPromise.resolve(DIGeoLocation.userLocationData),jQuery(document).trigger("di_geolocation_updated",{status:"OK",response:DIGeoLocation.userLocationData})},doClickyIntegration:function(a,b,c){"undefined"==typeof a||a===!1||"undefined"!=typeof clicky_custom&&clicky_custom!==!1||(clicky_custom={},"undefined"==typeof b||b===!1||(clicky_custom.timer=c),"undefined"!=typeof clicky_custom.visitor&&clicky_custom.visitor!==!1||(clicky_custom.visitor={}),DIGeoLocation.console_log("Clicky fired!"),DIGeoLocation.console_log(DIGeoLocation),clicky_custom.visitor.di_geo_isUserLocationDataAvailable=DIGeoLocation.userLocationData.isUserLocationDataAvailable,"number"==typeof DIGeoLocation.userLocationData.latitude&&(clicky_custom.visitor.di_geo_latitude=DIGeoLocation.userLocationData.latitude.toFixed(5)),"number"==typeof DIGeoLocation.userLocationData.latitude&&(clicky_custom.visitor.di_geo_longitude=DIGeoLocation.userLocationData.longitude.toFixed(5)))},createCookie:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+60*c*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},eraseCookie:function(a){DIGeoLocation.createCookie(a,"",-1)}};jQuery(window).load(function(){DIGeoLocation.init()});