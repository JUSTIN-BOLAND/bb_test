jQuery(function(){calculator.errors={JS_ERROR_PRICE:payment_calc_i18n.js_error_price,JS_ERROR_RATE:payment_calc_i18n.js_error_rate,JS_ERROR_LOAN_TERM:payment_calc_i18n.js_error_loan_term,JS_ERROR_DOWN_PAYMENT:payment_calc_i18n.js_error_down_payment,JS_ERROR_TRADEIN:payment_calc_i18n.js_error_tradein,JS_ERROR_TRADEIN_DOWN_PAYMENT:payment_calc_i18n.js_error_tradein_down_payment}});var EXIT_CUSTOM_MODE=payment_calc_i18n.exit_custom_mode,calculator={selector:"payment-calculator-container",container:null,months:null,price:null,rate:null,loan_term:null,custom_lt_mode:null,custom_month:null,down_payment:null,value_tradein:null,settings:null,fields:null,mainIndex:null,offset:0,data:null,errors:null,custom_rate_enabled:!0,fixed_rate_to_month:!1,default_disclaimer:null,init:function(a,b,c){try{var d=this;if(null===d.container){if(0===jQuery("."+d.selector).length)throw"Container "+d.selector+" does not exist!";d.container=jQuery("."+d.selector),d.fields={price:jQuery(d.container).find("#price"),down_payment:jQuery(d.container).find("#down_payment"),rate:jQuery(d.container).find("#rate"),loan_term:jQuery(d.container).find("#loan_term"),value_tradein:jQuery(d.container).find("#value_tradein"),cta_button:jQuery(d.container).find(".payment-calculator-cta-btn"),disclaimer:jQuery(d.container).find(".payment-calculator-disclaimer")},d.default_disclaimer||(d.default_disclaimer=d.fields.disclaimer.html())}if(a="undefined"!=typeof a?"new"===a.toLowerCase()?"new":"used":"new","undefined"==typeof finance_settings||"undefined"==typeof finance_settings[a])throw"Finance settings were not defined for vehicle type: "+a;if(d.settings=finance_settings[a],c&&jQuery.each(c,function(a,b){d.settings[a]=b}),"object"==typeof d.fields.loan_term){d.fields.loan_term.html("");var e=d.settings.term_list?d.settings.term_list.split(","):[12,24,36,48,60,72,84];jQuery.each(e,function(a,b){d.fields.loan_term.append('<option value="'+b+'">'+b+" months</option>")})}if("rate_list"in d.settings&&d.settings.rate_list){d.fields.rate.html("");var f=d.settings.rate_list.split(",");jQuery.each(f,function(a,b){d.fields.rate.append('<option value="'+b+'">'+b+" %</option>")})}if(d.settings.rate&&d.setRate(d.settings.rate),d.settings.length&&d.setLoanTerm(d.settings.length),!b||jQuery.isNumeric(b)===!1)return;if(d.fields.price.val(b),d.settings.down){var g=(d.settings.down/100*b).toFixed(0);d.fields.down_payment.val(g)}if(DealerInspireInventory.options.is_inventory_page&&"enabled"==d.settings.cta_button_state){var h=d.settings.cta_button_label?d.settings.cta_button_label:"Verify This Payment";d.fields.cta_button.text(h),d.fields.cta_button.parents(".payment-calculator-cta-wrap").removeClass("hidden"),jQuery(d.fields.cta_button).on("click",function(a){a.preventDefault(),jQuery.fancybox.close(),jQuery(".cta-button.vdp-primary").trigger("click")})}"custom_rate_enabled"in d.settings&&d.toggle_custom_interest_rate_switcher(d.settings.custom_rate_enabled),"fixed_rate_to_month"in d.settings&&d.toggle_fixed_rate_to_month(d.settings.fixed_rate_to_month),d.fixed_rate_to_month&&jQuery(d.fields.loan_term).on("change",function(a){jQuery(d.fields.rate).prop("selectedIndex",jQuery(d.fields.loan_term).prop("selectedIndex")),d.process()}),"disclaimer"in d.settings&&d.settings.disclaimer?d.fields.disclaimer.html(d.settings.disclaimer):d.fields.disclaimer.html(d.default_disclaimer)}catch(a){if("undefined"!=typeof console)return console.log("[Payment Calculator] Failed to set settings! "+a),!1}},process:function(a){a&&(this.container=jQuery(a).parents(".formBlock")),this.validate()&&this.calculate()},validate:function(a){try{return jQuery("body").trigger("im-payment-calculator-validate"),this.price=new Number(this.clean_number(this.fields.price.val())),this.rate=new Number(parseFloat(this.clean_number(this.fields.rate.val()))),this.loan_term=new Number(this.clean_number(this.fields.loan_term.val())),this.down_payment=new Number(this.clean_number(this.fields.down_payment.val())),this.value_tradein=new Number(this.clean_number(this.fields.value_tradein.val())),a?!isNaN(this.price)&&this.price>0&&!isNaN(this.rate)&&this.rate>0&&this.rate<100&&!isNaN(this.loan_term)&&this.loan_term>0:isNaN(this.price)||this.price<=0?(alert(this.errors.JS_ERROR_PRICE),!1):isNaN(this.rate)||this.rate<0||this.rate>100?(alert(this.errors.JS_ERROR_RATE),!1):isNaN(this.loan_term)||this.loan_term<0?(alert(this.errors.JS_ERROR_LOAN_TERM),!1):isNaN(this.down_payment)||this.down_payment<0||this.down_payment>=this.price?(alert(this.errors.JS_ERROR_DOWN_PAYMENT),!1):isNaN(this.value_tradein)||this.value_tradein<0||this.value_tradein>=this.price?(alert(this.errors.JS_ERROR_TRADEIN),!1):!(this.value_tradein+this.down_payment>=this.price)||(alert(this.errors.JS_ERROR_TRADEIN_DOWN_PAYMENT),!1)}catch(a){return"undefined"!=typeof console&&console.log(a.stack),!1}},calculate:function(){if(jQuery("body").trigger("im-payment-calculator-calculate"),!calculator.months){calculator.months=[];for(var a=jQuery("#loan_term option"),b=0;b<a.length;b++)calculator.months.push(parseInt(a[b].value))}if(this.custom_month=(new Array).concat(this.months),this.mainIndex=jQuery.inArray(parseInt(this.loan_term),this.custom_month),this.mainIndex==-1){var c=parseInt(this.loan_term);this.temp_index=0;for(var d=this.custom_month.length,e=0;e<d;e++)if(c<this.custom_month[e]){this.mainIndex=e,this.custom_month.splice(e,0,c);break}}if(this.data=new Array,this.addCustomFees(),this.principal=this.price-this.down_payment-(null==this.value_tradein?0:this.value_tradein),0==this.rate)for(var f=0;f<this.custom_month.length;f++){var g=(this.principal/this.custom_month[f]).toFixed(0);null===this.settings||"24"!==this.settings.payment_frequency&&"26"!==this.settings.payment_frequency||(g=12*g/26),this.data[f]=Math.ceil(g)}else{mointerest=100*this.rate/1e4/12;for(var f=0;f<this.custom_month.length;f++){x=Math.pow(1+mointerest,this.custom_month[f]);var g=(this.principal*x*mointerest/(x-1)).toFixed(0);null===this.settings||"24"!==this.settings.payment_frequency&&"26"!==this.settings.payment_frequency||(g=12*g/26),this.data[f]=Math.ceil(g)}}this.showResults(0)},setRate:function(a,b){try{var c=this;if(b="undefined"!=typeof b&&b,jQuery.isNumeric(a)===!1)throw new Error("Invalid rate.");var a=parseFloat(a);0===c.fields.rate.find("option[value='"+a+"']").length&&c.add_new_rate(a),c.fields.rate.val(a),b===!0&&c.validate(!0)===!0&&c.calculate()}catch(a){"undefined"!=typeof console&&console.log(a.stack)}},setLoanTerm:function(a,b){try{var c=this;if(b="undefined"!=typeof b&&b,jQuery.isNumeric(a)===!1)throw new Error("Invalid length.");var a=parseInt(a);0===c.fields.loan_term.find("option[value='"+a+"']").length&&c.add_new_loan_term(a),c.fields.loan_term.val(a),b===!0&&c.validate(!0)===!0&&c.calculate()}catch(a){"undefined"!=typeof console&&console.log(a.stack)}},setDownPayment:function(a,b){try{var c=this;if(b="undefined"!=typeof b&&b,jQuery.isNumeric(a)===!1)throw new Error("Invalid down payment.");var a=parseInt(a);c.fields.down_payment.val(a),b===!0&&c.validate(!0)===!0&&c.calculate()}catch(a){"undefined"!=typeof console&&console.log(a.stack)}},addCustomFees:function(){try{var a=this,b=a.settings.fees;if(window.payment_calculator_fees&&(b=payment_calculator_fees(a)),"undefined"==typeof b||!b)return!1;jQuery(".payment-calculator-custom-fees-container").remove(),jQuery(this.container).find(".form-button:first").before('<div class="payment-calculator-custom-fees-container"></div>'),"object"==typeof b&&jQuery.each(b,function(b,c){"string"==typeof c.amount&&c.amount.search("%")>-1&&a.price>0&&(c.amount=a.price*(c.amount.replace("%","")/100),c.amount=c.amount.toFixed(2)),jQuery.isNumeric(c.amount)!==!1&&("undefined"!=typeof c.hidden&&c.hidden===!0||jQuery(".payment-calculator-custom-fees-container").append("<div><label>"+c.label+': </label><span class="custom-fee"> '+DealerInspireInventory.format.currency(c.amount)+"</span></div>"),a.price+=parseFloat(c.amount))})}catch(a){"undefined"!=typeof console&&console.log("[Payment Calculator] Failed to add fees!"+a)}},setFees:function(a,b){try{var c=this;if(b="undefined"!=typeof b&&b,"undefined"==typeof a||!a)return!1;c.settings.fees=a,b===!0&&c.validate(!0)===!0&&c.calculate()}catch(a){"undefined"!=typeof console&&console.log("[Payment Calculator] Failed to add fees!"+a)}},showResults:function(a){if(null==this.data)return!1;var b=this.custom_month.length;if(0==a)var c=this.mainIndex;else var c=this.mainIndex+this.offset+a;if(c<0||c>b-1)return!1;this.offset+=a;var d=c>0?c-1:null,e=c<b-1?c+1:null;this.showPrev(d),this.showMain(c),this.showNext(e),this.showTotalAmountResult(this.custom_month[c])},showTotalAmountResult:function(a){var b=this.principal;null!==this.settings&&"24"===this.settings.payment_frequency?jQuery(".payment-info").html(payment_calc_i18n.payment_info_biweekly):jQuery(".payment-info").html(payment_calc_i18n.payment_info_monthly),jQuery(".amount-info > span").html("$"+this.number_format(b,0,".",","))},showMain:function(a){jQuery("td.mmain > .mbox-main").html("$"+this.data[a]),jQuery("td.mmain > .mtext-main").html(this.custom_month[a]+" "+payment_calc_i18n.months)},showPrev:function(a){null!=a?(jQuery("td.mleft > .mbox").html("$"+this.data[a]),jQuery("td.mleft > .mtext").html(this.custom_month[a]+" "+payment_calc_i18n.months)):(jQuery("td.mleft > .mbox").html("--"),jQuery("td.mleft > .mtext").html("--"))},showNext:function(a){null!=a?(jQuery("td.mright > .mbox").html("$"+this.data[a]),jQuery("td.mright > .mtext").html(this.custom_month[a]+" "+payment_calc_i18n.months)):(jQuery("td.mright > .mbox").html("--"),jQuery("td.mright > .mtext").html("--"))},clean_number:function(a){return"undefined"==typeof a?a:a=a.toString().replace(/\$|\,/g,"")},number_format:function(a,b,c,d){var e=a,f=isNaN(b=Math.abs(b))?2:b,g=void 0==c?",":c,h=void 0==d?".":d,i=e<0?"-":"",j=parseInt(e=Math.abs(+e||0).toFixed(f))+"",k=(k=j.length)>3?k%3:0;return i+(k?j.substr(0,k)+h:"")+j.substr(k).replace(/(\d{3})(?=\d)/g,"$1"+h)+(f?g+Math.abs(e-j).toFixed(f).slice(2):"")},getTotalAmountResult:function(a,b,c){if(0==b)return a;var d=.01*b/12;return a*d/(1-Math.pow(1+d,-c))*c},add_new_rate:function(a,b){b&&(this.container=b);var c=this.fields.rate;c.append('<option value="'+a+'" label="'+a+' %">'+a+" %</option>"),c.html(c.find("option:not(':first-child')").sort(function(a,b){return parseFloat(a.text)==parseFloat(b.text)?0:parseFloat(a.text)<parseFloat(b.text)?-1:1}))},clear_rates:function(a){a&&(this.container=a);var b=this.fields.rate;b.html("")},add_new_loan_term:function(a,b){b&&(this.container=b);var c=this.fields.loan_term,d=a+" "+(null===this.settings||"24"!==this.settings.payment_frequency&&"26"!==this.settings.payment_frequency?payment_calc_i18n.months:payment_calc_i18n.biweekly);c.append('<option value="'+a+'" label="'+d+'">'+d+"</option>"),c.html(c.find("option:not(':first-child')").sort(function(a,b){return a.text==b.text?0:a.text<b.text?-1:1}))},toggle_custom_interest_rate_switcher:function(a){this.custom_rate_enabled=a,a?$("#custom_interest_rate_switcher").show():$("#custom_interest_rate_switcher").hide()},toggle_fixed_rate_to_month:function(a){this.fixed_rate_to_month=a,a?$("#rate").prop("disabled",!0):$("#rate").prop("disabled",!1)}};jQuery(function(a){var b=payment_calc_i18n.custom;a("#custom_interest_rate_switcher").click(function(){return a(this).text()!=EXIT_CUSTOM_MODE?(a("#rate").hide().attr("name","rate_disabled").attr("id","rate_disabled"),a(this).before('<div class="custom-input-wrapper" id="rate_custom_input_wrapper"></div>'),a("#rate_custom_input_wrapper").append('<div class="input-append"><input type="text" id="rate" name="rate" class="text rate" /><span class="add-on">%</div>'),a("#rate").focus(),calculator.fields.rate=a("#rate"),b=a(this).text(),a(this).text(EXIT_CUSTOM_MODE)):(a(this).text(b),a("#rate_custom_input_wrapper").remove(),a("#rate_disabled").show().attr("name","rate").attr("id","rate"),calculator.fields.rate=a("#rate")),!1});var c=payment_calc_i18n.custom;if(a("#custom_loan_term_switcher").click(function(){return a(this).text()!=EXIT_CUSTOM_MODE?(calculator.custom_lt_mode=!1,a("#loan_term").hide().attr("name","loan_term_disabled").attr("id","loan_term_disabled"),a(this).before('<div class="custom-input-wrapper" id="loan_term_custom_input_wrapper"></div>'),a("#loan_term_custom_input_wrapper").append('<div class="input-append"><input type="text" id="loan_term" name="loan_term" class="text loan_term" /><span class="add-on">mo.</div>'),a("#loan_term").focus(),c=a(this).text(),a(this).text(EXIT_CUSTOM_MODE),calculator.fields.loan_term=a("#loan_term")):(calculator.custom_lt_mode=!0,a(this).text(c),a("#loan_term_custom_input_wrapper").remove(),a("#loan_term_disabled").show().attr("name","loan_term").attr("id","loan_term"),calculator.fields.loan_term=a("#loan_term")),!1}),"undefined"!=typeof attributes&&"1"==attributes.auto_calculate){var d=null;"overrides"in attributes&&(d=JSON.parse(attributes.overrides)),calculator.init(attributes.vehicle_type,attributes.price,d),calculator.process()}else"undefined"!=typeof DealerInspireInventory&&DealerInspireInventory.options.is_inventory_page||calculator.init()});