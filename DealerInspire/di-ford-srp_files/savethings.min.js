function markSavedItems(){var loadEvents=jQuery("#results-page").length?"savethings-list-complete savethings-drawer-loaded vrp-ready vrp-ajax-complete":"savethings-list-complete savethings-drawer-loaded",isVRP=jQuery("#results-page").length;jQuery(".project-hotwheels").length;jQuery("body").on(loadEvents,function(){var saveVehiclesSidr=jQuery("#save-vehicles-sidr"),vinElements=jQuery("[data-remote-id]",saveVehiclesSidr),savedVins=[];saveVehiclesSidr.length&&jQuery(vinElements).each(function(index,value){savedVins.push($(this).data("remote-id"))}),isVRP?jQuery(".vehicle").each(function(index,value){var saveBtn=jQuery(this).find(".save-things-save"),vin=jQuery(saveBtn).attr("rel");jQuery.inArray(vin,savedVins)>-1&&(jQuery(saveBtn).addClass("save-things-saved"),jQuery(saveBtn).find(".button-text").text("Saved"))}):jQuery(".save-vehicle").each(function(index,value){var vin=jQuery(this).data("remote-id");$.inArray(vin,savedVins)>-1&&jQuery(this).addClass("save-things-saved").find(".button-text").text("Saved")}),savedVins.length>0&&jQuery("#save-vehicles-expand-btn, #save-vehicles-custom-toggle, .mobile-tab.saved").addClass("vehicles-saved")})}var SaveThings=function(){function _init(){this.site_id=window.savethings.site_id,this.url=window.savethings.url||this.url,this.login_path=window.savethings.login_path||this.login_path,this.social=window.savethings.social||this.social,_checkAuth()}function _auth(successCallback){var authWindow=window.open(this.url+this.login_path+"?s="+this.social,"_new","width=680,height=310,toolbar=0,scrollbars=1,status=0,resizable=0,location=0,menuBar=0,left=30,top=50"),interval=setInterval(function(){try{authWindow&&authWindow.document.domain===document.domain?leftDomain&&"complete"===authWindow.document.readyState&&(clearInterval(interval),authWindow.postMessage({message:"requestResult"},"*")):leftDomain=!0}catch(e){if(authWindow.closed)return clearInterval(interval),void _checkAuth(successCallback);leftDomain=!0}},1e3)}function ReadCookie(c_name){var c_value=document.cookie,c_start=c_value.indexOf(" "+c_name+"=");if(c_start==-1&&(c_start=c_value.indexOf(c_name+"=")),c_start==-1)c_value=null;else{c_start=c_value.indexOf("=",c_start)+1;var c_end=c_value.indexOf(";",c_start);c_end==-1&&(c_end=c_value.length),c_value=unescape(c_value.substring(c_start,c_end))}return c_value?c_value:null}function CreateCookie(name,value,days){var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}else expires="";"object"==typeof value&&(value=JSON.stringify(value)),document.cookie=escape(name)+"="+escape(value)+expires+"; path=/"}function _authWithEmail(email,successCallback){jQuery.ajax({url:this.url+"/login/email/force?email="+email+"&iframe=true",dataType:"jsonp",cache:!1}).always(function(data){"undefined"!=typeof data.id&&data.id&&data.id.length>0&&(CreateCookie("savethings_hash",data.id,30),successCallback&&_checkAuth(successCallback))})}function _checkAuth(successCallback,failureCallback){var self=this;post_data=jQuery.extend({},defaultAjaxData()),jQuery.ajax({url:this.url+"/login/check",dataType:"jsonp",cache:!1,data:post_data}).always(function(data){data&&data.id?(self.logged_in=!0,_showLogout(),"undefined"!=typeof successCallback&&(successCallback(),jQuery("body").trigger("savethings-logged-in"))):(self.logged_in=!1,_showLogin(),"undefined"!=typeof failureCallback&&(failureCallback(),jQuery("body").trigger("savethings-auth-failed"))),jQuery("body").trigger("savethings-auth-completed")})}function defaultAjaxData(){var object={},hash=ReadCookie("savethings_hash");return"undefined"!=typeof hash&&hash&&hash.length>0&&(object.hash=hash),object}function _fetchItems(){return post_data=jQuery.extend(defaultAjaxData(),{site_id:this.site_id}),jQuery.ajax({url:this.url+"/items",data:post_data,dataType:"jsonp"}).always(function(){jQuery("body").trigger("savethings-list-complete")})}function _logout(){jQuery.ajax({url:this.url+"/signout",dataType:"jsonp",cache:!1}).always(function(data){_showLogin()})}function _removeItem(remote_id,success,failure){post_data=jQuery.extend(defaultAjaxData(),{site_id:this.site_id,remote_id:remote_id}),jQuery.ajax({url:this.url+"/items/remove",data:post_data,dataType:"jsonp",success:function(data){"undefined"!=typeof success&&success()},error:function(){"undefined"!=typeof failure&&failure()}})}function _saveItem(item,success,failure){post_data=jQuery.extend(defaultAjaxData(),{site_id:this.site_id},item),this.logged_in?jQuery.ajax({url:this.url+"/items/add",data:post_data,dataType:"jsonp",success:function(data){"undefined"!=typeof success&&success()},error:function(){"undefined"!=typeof failure&&failure()}}):_auth(function(){_saveItem(item,success,failure)})}function _showLogin(){jQuery(".savethings-logout").remove(),jQuery(function(){if(0==jQuery(".savethings-login").length){var loginLink=jQuery('<button class="button primary-button block">'+savethings.translate.login+"</button>").text(savethings.translate.login_to_save).addClass("savethings-login").css({width:"100%"});jQuery(".initial-saved-vehicles").prepend(loginLink)}jQuery(".button.savethings-login").on("click",function(){SaveThings.authPopup(loadSavedItems)})})}function _showLogout(){jQuery(".savethings-login").remove(),jQuery(document).ready(function(){})}return this.url="https://savevehicles.dealerinspire.com",this.site_id=-1,this.logged_in=!1,this.login_path="/login",this.social="y",_init(),{authPopup:function(successCallback){_auth(successCallback)},authWithEmail:function(email,successCallback){_authWithEmail(email,successCallback)},checkAuth:function(successCallback,failureCallback){_checkAuth(successCallback,failureCallback)},list:function(){return _fetchItems()},logout:function(){_logout()},save:function(item,success,failure){_saveItem(item,success,failure)},remove:function(item_id,success,failure){_removeItem(item_id,success,failure)}}}(),existingItems=[],existingItemIDs=[],loadSavedItems=function(){var existingItemsPromise=SaveThings.list();existingItemsPromise.success(insertSavedItems)},insertSavedItems=function(data){data.items.length>0&&jQuery(".save-vehicles .initial-saved-vehicles").remove(),jQuery.each(data.items,function(i,v){existingItemIDs.push(v.remote_id),jQuery(".save-vehicles").append('<div class="vehicle saved-'+v.remote_id+'"><h5><img src="/wp-content/plugins/inventory/js/fancybox/fancy_close.png" class="remove-saved-vehicle" data-remote-id="'+v.remote_id+'" style="vertical-align:middle"> <a href="'+v.url+'">'+v.title+'</a></h5><a href="'+v.url+'"><img class="thumbnail" src="'+v.thumbnail_url+'" /></a></div>'),jQuery("body").trigger("savethings-drawer-loaded")})};jQuery(function(){var sidrToggle=jQuery("#save-vehicles-expand-btn, #save-vehicles-custom-toggle");jQuery("#save-vehicles-expand-btn, #save-vehicles-custom-toggle").sidr({name:"save-vehicles-sidr",side:savethings.position,onOpen:function(){"left"==savethings.position?jQuery(sidrToggle).animate({marginLeft:260},200):jQuery(sidrToggle).animate({marginRight:260},200)},onClose:function(){"left"==savethings.position?jQuery(sidrToggle).animate({marginLeft:0},200):jQuery(sidrToggle).animate({marginRight:0},200)}}),jQuery(document).on("click",".remove-saved-vehicle",function(e){var self=this,vin=jQuery(this).data("remoteId");SaveThings.remove(jQuery(this).data("remoteId"),function(){jQuery(self).html(savethings.translate.save_this_vehicle).removeClass("saved-thing"),jQuery(".save-vehicles div.saved-"+vin).fadeOut(140,function(){jQuery(this).remove()})})}),jQuery(document).on("click",function(e){var clicked=e.target;jQuery(clicked).parents(".sidr").length<1&&!jQuery(clicked).hasClass("sidr")&&$.sidr("close","save-vehicles-sidr")}),jQuery(document).on("click",".save-things-save",function(e){e.preventDefault();var self=this,title=jQuery(this).data("title"),thumbnailUrl=jQuery(this).data("thumbnailUrl"),amount=jQuery(this).data("amount"),url=jQuery(this).data("url"),vin=jQuery(this).data("remoteId"),cart=jQuery(".save-vehicles"),alreadySaved=jQuery(cart).find(".saved-"+vin),isVRP=!!jQuery("#results-page").length;VDPid=jQuery(".project-hotwheels").length>0?jQuery("#vehicleDetails"):jQuery("#detailspage"),SaveThings.save({title:title,thumbnail_url:thumbnailUrl,amount:amount,url:url,remote_id:vin},function(){var imgtodrag=isVRP?jQuery(self).parents(".vehicle").find(".vehicle-image img"):jQuery(VDPid).find("#gallery-carousel img").first(),vehicle_image=jQuery(imgtodrag).attr("src"),vehicle_title=jQuery(self).data("title")?jQuery(self).data("title"):jQuery(self).closest(".vehicle").find(".vehicle-overview").attr("title");if(0===alreadySaved.length&&"undefined"!=typeof imgtodrag&&imgtodrag.length>0){var imgclone=imgtodrag.clone().offset({top:imgtodrag.offset().top,left:imgtodrag.offset().left}).css({opacity:"0.5",position:"absolute",height:"150px",width:"150px","z-index":"100"}).appendTo(jQuery("body"));"left"==savethings.position?imgclone.animate({top:cart.offset().top+100,left:cart.offset().left+10,width:150,height:150,zIndex:1e4},1e3,"easeOutQuart",function(){jQuery(".initial-saved-vehicles",cart).remove(),jQuery(cart).append('<div class="vehicle saved-'+vin+'"><h5><img src="/wp-content/plugins/inventory/js/fancybox/fancy_close.png" class="remove-saved-vehicle" data-remote-id="'+vin+'" style="vertical-align:middle"> <a href="'+url+'">'+vehicle_title+'</a></h5><a href="'+url+'"><img class="thumbnail" src="'+vehicle_image+'" /></a></div>')}):imgclone.animate({top:cart.offset().top+100,left:jQuery(window).width()-10,width:150,height:150,zIndex:1e4},1e3,"easeOutQuart",function(){jQuery(".initial-saved-vehicles",cart).remove(),jQuery(cart).append('<div class="vehicle saved-'+vin+'"><h5><img src="/wp-content/plugins/inventory/js/fancybox/fancy_close.png" class="remove-saved-vehicle" data-remote-id="'+vin+'" style="vertical-align:middle"> <a href="'+url+'">'+vehicle_title+'</a></h5><a href="'+url+'"><img class="thumbnail" src="'+vehicle_image+'" /></a></div>')}),imgclone.animate({width:0,height:0},function(){jQuery(this).detach()}),jQuery(self).addClass("save-things-saved"),jQuery("#save-vehicles-expand-btn, #save-vehicles-custom-toggle, .mobile-tab.saved").addClass("vehicles-saved"),jQuery("body").trigger("savethings-save-vehicle",self)}},function(){})}),jQuery("body").live("vrp-ajax-complete",function(){var savedButton=jQuery("#save-vehicles-expand-btn");setTimeout(function(){jQuery(savedButton).show(),jQuery(savedButton).sidr({name:"save-vehicles",side:"left",onOpen:function(){jQuery(savedButton).animate({marginLeft:260},200)},onClose:function(){jQuery(savedButton).animate({marginLeft:0},200)}})},500)}),loadSavedItems(),markSavedItems()});