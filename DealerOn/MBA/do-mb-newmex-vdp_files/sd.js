var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},_SD;!function(e){var t=function(){function e(){}return e}();t.tagServerUrl="mb-usa-tagging-tagserver-prod.azurewebsites.net",t.scriptUrl="mbusa-tagging-prod.azureedge.net/scripts",t.imageTagPath="1x1.gif",t.ajaxPostPath="data",t.forceSSL=!1,t.dataLayer="sdDataLayer",t.debug=!1,t.blockSendIfCookiesDisabled=!0,t.cookieDomainPeriods=2,e.Configuration=t;var n=function(){function e(){}return e}();n.version="1.13",n.cookieNamePrefix="_sd:",n.serializeEscapeChar="!",n.cookieMaxLength=4e3,n.userCookieName=n.cookieNamePrefix+"user",n.sessionCookieName=n.cookieNamePrefix+"session",n.errorPrefix="SD::",n.debugPrefix="[SD] ",n.loopFreqMs=100,n.pingFreqMs=3e4,n.considerIdleAfterMs=6e4,n.maxIdleMs=12e4,n.sessionTimeoutMs=54e4,n.pluginLoadTimeoutMs=2e3,n.publishCallbackTimeoutMs=1e3,e.Constants=n;var r=function(){function e(){}return e}();r.cacheBuster="cb",r.campaign="cmp",r.campaignType="cmpt",r.campaignName="cmpn",r.channel="ch",r.clientId="cl",r.colorDepth="d",r.debug="dbg",r.digAdAdId="daa",r.digAdCid="dac",r.digAdKeyword="dak",r.digAdProvider="dap",r.encoding="enc",r.eventCategory="ec",r.eventAction="ea",r.eventLabel="el",r.eventValue="ev",r.eventNonInteractive="eni",r.eVars="evars",r.externalId="exid",r.flashVersion="fl",r.globalId="gid",r.hitType="ht",r.hitId="hid",r.javaEnabled="je",r.language="l",r.pageViewId="pid",r.props="props",r.providerId="prid",r.referrer="rf",r.resolution="rs",r.retailerId="rid",r.sdId="sdid",r.sessionId="sid",r.timestamp="ts",r.title="t",r.trace="sd_trace",r.url="u",r.userId="uid",r.version="v",r.viewportSize="vp",r.incomingCampaign="sd_campaign",r.incomingCampaignType="sd_campaign_type",r.incomingCampaignName="sd_campaign_name",r.incomingChannel="sd_channel",r.incomingDigAdAdId="sd_digadid",r.incomingDigAdCid="sd_digadcid",r.incomingDigAdKeyword="sd_digadkeyword",r.incomingDigAdProvider="sd_digadprov",r.incomingTrace="sd_trace",r.incomingCrossDomainInfo="sd_xdinfo",r.incomingPlugins="sd_plugins",r.incomingReferrer="sd_referrer",e.Map=r;var i=function(){function e(){this._lastLoopTime=0,this._idleTimeMs=0,this._isSuspended=0,this._isPingDisabled=!1;var e=this;e._commandProcessor=new o(this);var t=_.getTimeInTicks();e._lastCmdTime=t,e._lastLoopTime=t;var n=_.getSD();if(n.sync=function(){this.sdSync(Array.prototype.slice.call(arguments))},"prerender"===document.visibilityState){var r=function(t){"visible"===document.visibilityState&&(_.removeEvent(document,"visibilitychange",r),e._start())};_.addEvent(document,"visibilitychange",r)}else e._start()}return e.prototype._process=function(e){var t=this,r=_.getTimeInTicks(),i=_.getSDQueue();if(i&&(!_.isHidden()||e))if(0!==i.length){for(;0!==i.length&&!t._isSuspended;)try{t._processItem(i.shift())}catch(e){_.error("Loop::Process error",e)}t._lastCmdTime=r}else e||0!==n.pingFreqMs&&!t._isPingDisabled&&t._idleTimeMs<n.considerIdleAfterMs&&t._lastCmdTime+n.pingFreqMs<_.getTimeInTicks()&&this.push(["send","ping"]);e||(t._idleTimeMs+=r-t._lastLoopTime,!t._isPingDisabled&&t._idleTimeMs>n.maxIdleMs&&(t._isPingDisabled=!0),t._lastLoopTime=r,window.setTimeout(function(){return t._process()},n.loopFreqMs))},e.prototype._start=function(){var e=this;window.setTimeout(function(){return e._process()},n.loopFreqMs);var t=function(t){e._idleTimeMs=0};_.addEvent(document,"mousemove",t),_.addEvent(document,"keydown",t),_.debug("SD "+n.version+" initialized.")},e.prototype._processItem=function(e){e&&e.length&&e.length>0&&(this._commandProcessor.process(e[0],Array.prototype.slice.call(e,1)),this._isPingDisabled&&(this._isPingDisabled=!1))},e.prototype.suspend=function(){this._isSuspended++},e.prototype.resume=function(){this._isSuspended>0&&this._isSuspended--},e.prototype.push=function(e){var t=_.getSDQueue();t&&t.push(e)},e.prototype.insert=function(e){var t=_.getSDQueue();t&&t.unshift(e)},e.prototype.insertBefore=function(e,t){var n=_.getSDQueue();if(n){for(var r=0;r<n.length&&n[r][0]!==e;r++);n.splice(r,0,t)}},e.prototype.getQueueSize=function(){var e=_.getSDQueue();return e?e.length:0},e.prototype.sd=function(e,t){e&&(this.push(e),e.length&&e.length>0&&"send"===e[0]&&t!==!0&&this._process(!0))},e.prototype.sdSync=function(e){this.sd(e,!0),this._process(!0)},e}();e.Loop=i;var o=function(){function e(e){this.loop=e,this._mapCmdToPipeline={},this._state={clientId:"",retailerId:"",providerId:"",userId:"",pageViewId:_.generateGuid(),props:{},eVars:{},campaign:"",campaignType:"",campaignName:"",channel:"",digAdAdId:"",digAdCid:"",digAdKeyword:"",digAdProvider:"",dataLayer:""},this._coreCommands=[new c,new d,new p,new y,new f,new h,new g,new l,new v,new m,new u,new w],this.setPlugins([],!1)}return e.prototype.getLoop=function(){return this.loop},e.prototype.getState=function(){return this._state},e.prototype.process=function(e,t){if("function"==typeof e)return void e();var r=this._mapCmdToPipeline[e.toLowerCase()];if(!r||0===r.length)throw new Error(n.errorPrefix+"Unknown command: "+e);for(var i=0;i<r.length;i++){var o=r[i].action.apply(r[i].plugin,t);if(o)break}},e.prototype.setPlugins=function(e,t){var n=this;e&&!_.isArray(e)&&(e=[e]),this._loadPlugins(e,function(e){var r;r=t&&n._plugins&&0!==n._plugins.length?n._plugins.concat(e):n._coreCommands.concat(e),r=_.uniqueArray(r),r.sort(function(e,t){return(t.priority||0)-(e.priority||0)}),n._plugins=r;var i={commandProcessor:n};n._mapCmdToPipeline={};for(var o=0;o<n._plugins.length;o++){"function"==typeof n._plugins[o].init&&n._plugins[o].init(i);for(var a in n._plugins[o])if("_"===a.substring(0,1)&&"function"==typeof n._plugins[o][a]){var s=a.substring(1).toLowerCase();n._mapCmdToPipeline[s]=n._mapCmdToPipeline[s]||[],n._mapCmdToPipeline[s].push({plugin:n._plugins[o],action:n._plugins[o][a]})}}})},e.prototype._loadPlugins=function(e,r){var i=this;e=_.uniqueArray(e);var o=e.length;if(0===o)return void r(e);for(var s=function(){o--,0===o&&r(e)},c=0;c<e.length;c++){var d=e[c];if("string"==typeof d){var u,p,l=d.indexOf("|");l!==-1?(u=d.substr(0,l),p=d.substr(l+1),p.indexOf("//")===-1&&(p="//"+p)):(u=d,p="//"+t.scriptUrl+"/sd_"+d+".js");var g=a.getPlugin(u);g?(e[c]=g,s()):(i.loop.suspend(),function(t,r,o){a.waitForLoad(r,function(n){n?e[t]=n:_.error("Plugin load failed: "+r),i.loop.resume(),s()},n.pluginLoadTimeoutMs);var c=document.createElement("script");c.src=o,c.async=!0;var d=document.body||document.getElementsByTagName("head")[0];d.appendChild(c)}(c,u,p))}else s()}},e}();e.CommandProcessor=o;var a=function(){function t(){}return t.registerPlugin=function(n,r){e.Utils.debug(n+" plugin loaded."),r&&(n=n.toLowerCase(),t._plugins[n]=r);var i=t._watchers[n];if(i){clearTimeout(i.timer);var o=t.getPlugin(n);i.callback(o),delete t._watchers[n]}},t.getPlugin=function(e){return e=e.toLowerCase(),t._plugins[e]},t.waitForLoad=function(e,n,r){e=e.toLowerCase(),t._watchers[e]={callback:n,timer:setTimeout(function(){var r=t.getPlugin(e);n(r)},r)}},t}();a._plugins={},a._watchers={},e.PluginContainer=a;var s=function(){function e(){this.priority=1}return e.prototype.init=function(e){this.commandProcessor=e.commandProcessor,this.state=this.commandProcessor.getState()},e.prototype.debug=function(e){if(e){var t=100;e+="";var n=this.state.dbg||"";n&&(e=n+","+e),e.length>t&&(e=e.substring(0,t)),this.state.dbg=e}},e}();e.Plugin=s;var c=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._plugins=function(e,t){return this.commandProcessor.setPlugins(e,t||!1),!0},t}(s);e.PluginsCommand=c;var d=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._create=function(){var e=_.getArgs(arguments,"clientId","retailerId","providerId"),t=e.clientId||"",r=e.retailerId||"",i=e.providerId||"",o=this.getQueryStringVariables();if(!(t&&r&&i||o.crossDomainInfo))throw new Error(n.errorPrefix+"Must specify clientId, retailerId and providerId when calling create.");this.state.clientId=t,this.state.retailerId=r,this.state.providerId=i,this.state.sdId||(this.state.sdId=_.generateRandomId());var a=b.readUserCookie();a.id||(a.id=_.generateGuid(),a.timestamp=_.getTimeInTicks()),this.state.userId=a.id,b.writeUserCookie(a);var s=b.readSessionCookie(),c=!1;for(var d in o)if(o.hasOwnProperty(d)){var u=o[d];"trace"===d?u&&(s.trace=_.stringToBool(u),c=!0):"plugins"===d?u&&(s.plugins=u.split(","),c=!0):this.state[d]=u}c&&b.writeSessionCookie(s);var p=[];s.trace&&p.push("trace"),0!==s.plugins.length&&(p=p.concat(s.plugins));for(var l="",g=l.split(","),f=0;f<g.length;f++)g[f]&&p.push(g[f]);return 0!==p.length&&this.commandProcessor.getLoop().insertBefore("send",["plugins",p,!0]),o.crossDomainInfo&&this.commandProcessor.getLoop().insertBefore("send",["xdImport",o.crossDomainInfo]),!0},t.prototype.getQueryStringVariables=function(){var e={},t=_.getQueryParams(function(e){return e.toLowerCase()});return e.campaign=t[r.incomingCampaign],e.campaignType=t[r.incomingCampaignType],e.campaignName=t[r.incomingCampaignName],e.channel=t[r.incomingChannel],e.digAdAdId=t[r.incomingDigAdAdId],e.digAdCid=t[r.incomingDigAdCid],e.digAdKeyword=t[r.incomingDigAdKeyword],e.digAdProvider=t[r.incomingDigAdProvider],e.crossDomainInfo=t[r.incomingCrossDomainInfo],e.plugins=t[r.incomingPlugins],e.trace=t[r.incomingTrace],e.referrer=t[r.incomingReferrer],e},t}(s);e.CreateCommand=d;var u=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._link=function(){var e=_.getArgs(arguments,"targetUrl","useHash"),t=function(e){document.location.href=e};return this.commandProcessor.getLoop().insert(["getLinkerUrl",{targetUrl:e.targetUrl,useHash:e.useHash,callback:t}]),!0},t.prototype._linkByPost=function(){var e=_.getArgs(arguments,"formObject","useHash"),t=e.formObject;if(t&&t.action){var n=function(t){e.formObject.action=t};this.commandProcessor.getLoop().insert(["getLinkerUrl",{targetUrl:e.formObject.action,useHash:e.useHash,callback:n}])}return!0},t.prototype._getLinkerUrl=function(){var e=_.getArgs(arguments,"targetUrl","useHash","callback");if(!e.callback)return!0;var t=function(t){var n=r.incomingCrossDomainInfo+"="+t,i=e.useHash?null:n,o=e.useHash?n:null;e.callback(_.addParamsToUrl(e.targetUrl,i,o))};return this.commandProcessor.getLoop().insert(["xdExport",t]),!0},t.prototype._xdExport=function(){var e=this,t=_.getArgs(arguments,"callback");if(!t.callback)return!0;var n=function(){r=b.readSessionCookie();var n=[e.state.clientId,e.state.providerId,e.state.retailerId,e.state.userId,r.id,r.expire,e.state.pageViewId].join("|");n=encodeURIComponent(n),t.callback(n)},r=b.readSessionCookie();return!r.id||r.expire<_.getTimeInTicks()?(this.commandProcessor.getLoop().insert([n]),this.commandProcessor.getLoop().insert(["send","pageview"])):n(),!0},t.prototype._xdImport=function(){var e=_.getArgs(arguments,"data");if(e.data){var t=e.data.split("|");if(t&&7===t.length){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=parseInt(t[5],10),d=t[6];this.state.clientId=r,this.state.retailerId=o,this.state.providerId=i,this.state.userId=a;var u=b.readUserCookie();u.id=a,u.timestamp=_.getTimeInTicks(),b.writeUserCookie(u);var p=b.readSessionCookie();c>_.getTimeInTicks()&&(p.id=s,p.expire=_.getTimeInTicks()+n.sessionTimeoutMs,b.writeSessionCookie(p),this.state.pageViewId=d),this.state.isXdImport=!0}}return!0},t}(s);e.CrossDomainCommands=u;var p=function(e){function i(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(i,e),i.prototype._send=function(){var e=_.getArgs(arguments,"hitType","eventCategory","eventAction","eventLabel","eventValue","eventNonInteractive","hitCallback");e.hitType=(e.hitType||"").toLowerCase();var i=e.hitType;if(!i){var o=this.getDataLayerEvents(!0);if(0===o.length)return e.hitCallback&&e.hitCallback(),!0;i="event",e.hitType="event",e.eventCategory=o[0].eventCategory,e.eventAction=o[0].eventAction,e.eventLabel=o[0].eventLabel,e.eventValue=o[0].eventValue,e.eventNonInteractive=o[0].eventNonInteractive}var a="pageview"===i,s="ping"===i,c="event"===i;if(t.blockSendIfCookiesDisabled&&!b.getCookieSupport().session&&!this.state.isXdImport)return _.error("Session cookies disabled, skipping send."),e.hitCallback&&e.hitCallback(),!0;if(this.validate(e)){a&&(this.state.pageViewId=_.generateGuid());var d=this.state.clientId,u=this.state.retailerId,p=this.state.providerId,l=b.readSessionCookie();if(!l.id||l.expire<_.getTimeInTicks()){if(!l.id){var g=this.state.sessionCookie;if(g&&g.expire>_.getTimeInTicks())return _.error("Session cookie read failed, skipping send."),b.getCookieSupport().session=!1,e.hitCallback&&e.hitCallback(),!0}if(!a)return s||this.commandProcessor.getLoop().insert(["send"].concat(Array.prototype.slice.call(arguments))),this.commandProcessor.getLoop().insert(["send","pageview"]),!0;l.id=_.generateGuid(),this.commandProcessor.getLoop().insert(["sessionStarted",l.id])}var f=_.getTimeInTicks()+n.sessionTimeoutMs;l.expire=f,b.writeSessionCookie(l),this.state.sessionCookie={id:l.id,expire:l.expire};var h={};if(h[r.hitType]=i,h[r.clientId]=d,h[r.retailerId]=u,h[r.providerId]=p,h[r.userId]=this.state.userId,h[r.sessionId]=l.id,h[r.pageViewId]=this.state.pageViewId,h[r.hitId]=_.generateGuid(),h[r.sdId]=this.state.sdId,!s){var o=this.getDataLayerEvents();this.setPropsForDataLayerFields(),h[r.eVars]=C.dictionaryToString(I.getEVars(this.state)),h[r.props]=C.dictionaryToString(k.getProps(this.state)),h[r.campaign]=this.state.campaign||"",h[r.campaignName]=this.state.campaignName||"",h[r.campaignType]=this.state.campaignType||"",h[r.channel]=this.state.channel||"",h[r.digAdAdId]=this.state.digAdAdId||"",h[r.digAdCid]=this.state.digAdCid||"",h[r.digAdKeyword]=this.state.digAdKeyword||"",h[r.digAdProvider]=this.state.digAdProvider||"",this.state.campaign="",this.state.campaignName="",this.state.campaignType="",this.state.channel="",this.state.digAdAdId="",this.state.digAdCid="",this.state.digAdKeyword="",this.state.digAdProvider=""}if(c){var v=e.eventCategory||"";h[r.eventCategory]=v,h[r.eventAction]=e.eventAction||"",h[r.eventLabel]=e.eventLabel||"",h[r.eventValue]=parseInt(e.eventValue||"0",10),h[r.eventNonInteractive]=e.eventNonInteractive?"true":"false";for(var m=v.toLowerCase(),y=o.length-1;y>=0;y--)o[y].eventCategory.toLowerCase()===m&&o.splice(y,1)}if(s||this.addDebugData(h),this.addBrowserData(h),a&&this.state.referrer){var w=this.state.referrer;"http"!==w.toLowerCase().substring(0,4)&&(w="http://"+w),h[r.referrer]=w,this.state.referrer=null}if(this.publish(h,e.hitCallback),!s)for(var y=0;y<o.length;y++)this.commandProcessor.getLoop().push(["send","event",o[y].eventCategory,o[y].eventAction,o[y].eventLabel,o[y].eventValue,o[y].eventNonInteractive])}return!0},i.prototype.validate=function(e){var t=e.hitType;if("pageview"!=t&&"ping"!=t&&"event"!=t)throw new Error(n.errorPrefix+"Unknown hit type: "+t);if("event"==t&&!e.eventCategory)throw new Error(n.errorPrefix+"Event category required when firing event.");if(!this.state.clientId)throw new Error(n.errorPrefix+"ClientId not set.");if(!this.state.retailerId)throw new Error(n.errorPrefix+"RetailerId not set.");if(!this.state.providerId)throw new Error(n.errorPrefix+"ProviderId not set.");if(!this.state.userId)throw new Error(n.errorPrefix+"UserId not set.");return!0},i.prototype.publish=function(e,t){this.commandProcessor.getLoop().insert(["publish",{params:e,hitCallback:t}])},i.prototype.getDataLayerEvents=function(e){var n=[],r=window[t.dataLayer];if(r&&r.events){var i=r.events;if("string"==typeof i&&(i=i.split(",")),_.isArray(i))for(var o={},a=0;a<i.length;a++)if(i[a]&&"string"==typeof i[a]){var s=i[a].split("|"),c=_.trim(s[0]),d=c.toLowerCase();if(!o[d]){o[d]=!0;var u={eventCategory:_.trim(s[0]),eventAction:s[1]||"",eventLabel:s[2]||"",eventValue:s[3]||"",eventNonInteractive:s[4]||""};n.push(u)}}e||delete r.events}return n},i.prototype.setPropsForDataLayerFields=function(){var e,n=this.state.dataLayer,r=_.flatten(window[t.dataLayer]),i=_.diff(n,r);for(e=0;e<i.adds.length;e++)k.setProp(this.state,i.adds[e][0],i.adds[e][1]);for(e=0;e<i.changes.length;e++)k.setProp(this.state,i.changes[e][0],i.changes[e][2]);this.state.dataLayer=r},i.prototype.addDebugData=function(e){this.state.dbg&&(e[r.debug]=this.state.dbg+"",this.state.dbg="")},i.prototype.addBrowserData=function(e){e[r.cacheBuster]=_.generateRandomId(),e[r.colorDepth]=window.screen.colorDepth+"-bit",e[r.encoding]=document.characterSet||document.charset,e[r.flashVersion]=this.getFlashVersion(),e[r.javaEnabled]=navigator&&"function"==typeof navigator.javaEnabled&&navigator.javaEnabled()||!1,e[r.language]=(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),e[r.referrer]=document.referrer,e[r.resolution]=window.screen.width+"x"+window.screen.height,e[r.timestamp]=_.getTimeInTicks(),e[r.title]=document.title,e[r.url]=document.location.href,e[r.version]=n.version,e[r.viewportSize]=this.getViewportSize()},i.prototype.getViewportSize=function(){var e="",t=[0,0],n=document.body&&document.body.clientWidth&&document.body.clientHeight,r=document.documentElement;return r&&r.clientWidth&&r.clientHeight&&("CSS1Compat"===document.compatMode||!n)?t=[r.clientWidth,r.clientHeight]:n&&(t=[document.body.clientWidth,document.body.clientHeight]),t[0]&&t[1]&&(e=t.join("x")),e},i.prototype.getFlashVersion=function(){var e,t,n;if((n=(n=window.navigator)?n.plugins:null)&&n.length)for(var r=0;r<n.length&&!t;r++){var i=n[r];-1<i.name.indexOf("Shockwave Flash")&&(t=i.description)}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),t=e.GetVariable("$version")}catch(e){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),t="WIN 6,0,21,0",e.AllowScriptAccess="always",t=e.GetVariable("$version")}catch(e){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),t=e.GetVariable("$version")}catch(e){}return t&&(e=t.match(/[\d]+/g))&&3<=e.length&&(t=e[0]+"."+e[1]+" r"+e[2]),t||""},i}(s);e.SendCommand=p;var l=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._setProp=function(e,t){return k.setProp(this.state,e,t),!0},t.prototype._getProp=function(e,t){return t(k.getProp(this.state,e)),!0},t}(s);e.PropsCommands=l;var g=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._setEVar=function(e,t){return I.setEVar(this.state,e,t),!0},t.prototype._getEVar=function(e,t){return t(I.getEVar(this.state,e)),!0},t}(s);e.EVarsCommands=g;var f=function(e){function n(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(n,e),n.prototype._config=function(e,n){return e in t&&(t[e]=n),!0},n}(s);e.ConfigCommand=f;var h=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._debug=function(e){return _.debug(e),!0},t}(s);e.DebugCommand=h;var v=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype.init=function(t){var n=this;e.prototype.init.call(this,t),_.ready(function(){return n.commandProcessor.getLoop().insert(["trackLinks"])})},t.prototype._trackLinks=function(){var e=this;if(document&&document.getElementsByTagName){var t=document.getElementsByTagName("a");if(t&&t.length)for(var n=0;n<t.length;n++)!function(){if(t[n]&&t[n].getAttribute&&!t[n]._sdLink){t[n]._sdLink=!0;var r=t[n].getAttribute("data-sd-event");if(r){for(var i=(t[n].getAttribute("data-sd-event-link")||"").toLowerCase(),o=t[n].getAttribute("data-sd-event-set-prop")||"",a=t[n].getAttribute("data-sd-event-set-evar")||"",s=r.split(","),c=0,d=0,u=0;u<s.length;u++)!function(){var r=s[u].split("|");if(r&&r.length>0){var p=t[n].href;if(p&&"javascript:"!==p.substring(0,11)){c++;var l=r[0],g=r[1]||"",f=r[2]||"",h=r[3]||"",v=r[4]||"";_.addEvent(t[n],"click",function(t){_.preventDefault(t),_.stopPropagation(t);var n={hitType:"event",eventCategory:l,eventAction:g,eventLabel:f,eventValue:h,eventNonInteractive:v,hitCallback:function(){if(d--,!d){d=c;var t=function(e){document.location.href=e};"false"!==i?e.commandProcessor.getLoop().insert(["getLinkerUrl",{targetUrl:p,useHash:"hash"===i,callback:t}]):t(p)}}};if(e.commandProcessor.getLoop().insert(["send",n]),o)for(var r=o.split(","),s=0;s<r.length;s++)if(r[s]){var u=r[s].split("|");u.length>=2&&e.commandProcessor.getLoop().insert(["setProp",u[0],u.slice(1).join("|")])}if(a)for(var m=a.split(","),s=0;s<m.length;s++)if(m[s]){var u=m[s].split("|");u.length>=2&&e.commandProcessor.getLoop().insert(["setEVar",u[0],u.slice(1).join("|")])}})}else _.error("data-sd-event not supported for Javascript links.")}}();d=c}}}()}},t}(s);e.TrackLinksCommand=v;var m=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype.init=function(t){var n=this;e.prototype.init.call(this,t),_.ready(function(){return n.commandProcessor.getLoop().insert(["trackIFrames"])})},t.prototype._trackIFrames=function(){var e=this;if(document&&document.getElementsByTagName){var t=document.getElementsByTagName("iframe");if(t&&t.length)for(var n=0;n<t.length;n++)!function(){var r=t[n];if(r&&r.getAttribute&&!r._sdIFrame){r._sdIFrame=!0;var i=r.getAttribute("src"),o=null!==r.getAttribute("data-sd-iframe");if(o&&i&&"about:blank"!==i){var a=function(e){r.src=e};e.commandProcessor.getLoop().insert(["getLinkerUrl",{targetUrl:i,callback:a}])}}}()}},t}(s);e.TrackIFramesCommand=m;var y=function(e){function r(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(r,e),r.prototype._publish=function(){var e=_.getArgs(arguments,"params","hitCallback"),t=e.params,r=e.hitCallback,i=this.paramsToString(t);if(r=r?this.wrapCallbackWithTimeout(r,n.publishCallbackTimeoutMs):function(){},i.length<=2036)this.sendWithImageTag(i,r);else{if(!(i.length<=8192))throw new Error(n.errorPrefix+"Payload >8192 bytes not supported.");navigator.userAgent.indexOf("Firefox")>0&&![].reduce?r():this.sendWithXmlHttpRequest(i,r)||this.sendWithXDomainRequest(i,r)||this.sendWithIFrame(i,r)||r()}return!0},r.prototype.wrapCallbackWithTimeout=function(e,t){var n=!1,r=0,i=function(t){r&&(window.clearTimeout(r),r=0),n||(n=!0,e())};return r=window.setTimeout(function(){return i(!0)},t),i},r.prototype.sendWithImageTag=function(e,n){var r=this.getProtocol()+"//"+t.tagServerUrl+"/"+t.imageTagPath+"?"+e,i=document.createElement("img");return i.width=1,i.height=1,i.src=r,i.onload=i.onerror=function(){i.onload=null,i.onerror=null,n()},!0},r.prototype.sendWithXmlHttpRequest=function(e,n){if("undefined"==typeof window.XMLHttpRequest)return!1;var r=new window.XMLHttpRequest;return"withCredentials"in r&&(r.open("POST",this.getProtocol()+"//"+t.tagServerUrl+"/"+t.ajaxPostPath,!0),r.withCredentials=!0,r.setRequestHeader("Content-Type","text/plain"),r.onreadystatechange=function(){4===r.readyState&&(n(),r=null)},r.send(e),!0)},r.prototype.sendWithXDomainRequest=function(e,n){if("undefined"==typeof window.XDomainRequest)return!1;var r=new window.XDomainRequest;return r.open("POST",this.getProtocol()+"//"+t.tagServerUrl+"/"+t.ajaxPostPath),r.onerror=function(){return n()},r.onload=function(){return n()},r.send(e),!0},r.prototype.sendWithIFrame=function(e,n){var r=this;if(!document.body)return window.setTimeout(function(){return r.sendWithIFrame(e,n)},100),!0;e=encodeURIComponent(e);var i;try{i=document.createElement('<iframe name="'+e+'"></iframe>')}catch(t){i=document.createElement("iframe"),i.name=e}i.height="0",i.width="0",i.style.display="none",i.style.visibility="hidden";var o=r.getProtocol()+"//"+t.tagServerUrl+"/iframe.aspx#"+encodeURIComponent(document.location.protocol+"//"+document.location.host+"/favicon.ico"),a=function(){i.src="",i.parentNode&&i.parentNode.removeChild(i)};_.addEvent(document,"beforeunload",a);var s=!1,c=0,d=function(){if(!s){try{if(c>9||i.contentWindow.location.host===document.location.host)return s=!0,a(),_.removeEvent(document,"beforeunload",a),n()}catch(e){}c++,setTimeout(d,200)}};return _.addEvent(i,"load",d),document.body.appendChild(i),i.src=o,!0},r.prototype.getProtocol=function(){return t.forceSSL||"https:"===document.location.protocol?"https:":"http:"},r.prototype.paramsToString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+encodeURIComponent(""+e[n]));return t.join("&")},r}(s);e.PublishCommand=y;var w=function(e){function t(){var t=e.apply(this,arguments)||this;return t.priority=0,t}return __extends(t,e),t.prototype._sessionStarted=function(e){return!0},t}(s);e.SessionStartedCommand=w;var b=function(){function e(){}return e.getCookieSupport=function(){return e._cookieSupport},e.readUserCookie=function(){var t={id:"",version:0,timestamp:0},r=e.readCookie(n.userCookieName);if(r){var i=r.split(":");i&&3===i.length&&(t.id=i[0],t.version=parseInt(i[1],10),t.timestamp=parseInt(i[2],10))}return t},e.writeUserCookie=function(r){var i=[r.id,n.version,r.timestamp],o=i.join(":"),a=new Date,s=document.domain.split(".").slice(0-t.cookieDomainPeriods).join(".");return a.setFullYear(a.getFullYear()+1),e.writeCookie(n.userCookieName,o,{expires:a,domain:s})},e.readSessionCookie=function(){var t={id:"",trace:!1,expire:0,plugins:[]},r=e.readCookie(n.sessionCookieName);if(r){var i=r.split(":");i&&4===i.length&&(t.id=i[0],t.trace="Y"===i[1],t.expire=parseInt(i[2],10),t.plugins=0!==i[3].length?i[3].split(","):[])}return t},e.writeSessionCookie=function(t){var r=[t.id,t.trace?"Y":"N",t.expire,t.plugins.join(",")],i=r.join(":");return e.writeCookie(n.sessionCookieName,i)},e.readCookies=function(t){var n={};if(!t){var r=e._cookieJar;for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])}for(var o=document.cookie.split(";"),a=0;a<o.length;a++){var s=o[a].indexOf("="),c=_.trim(o[a].substring(0,s)),d=decodeURIComponent(_.trim(o[a].substring(s+1)));n[c]=d}return n},e.readCookie=function(t,n){var r=e.readCookies(n),i=r[t]||"";return i},e.writeCookie=function(t,n,r){r=r||{};var i=n,o=e._cookieSupport;if(o.persisted||(r.domain=null,r.expires=null),o.persisted||o.session){i=encodeURIComponent(n);var a=t+"="+i;a+="; path="+(r.path||"/"),r.expires&&(a+="; expires="+r.expires.toUTCString()),r.domain&&"localhost"!==r.domain&&(a+="; domain="+r.domain),document.cookie=a;var s=e.readCookie(t,!0);if(s!==n){var c=r.expires?"Persisted":"Session";if(_.error(c+" cookie write failed, N["+t+"], E["+(n||"")+"], A["+(s||"")+"]"),r.expires)return o.persisted=!1,e.writeCookie(t,n,r);o.session=!1}}var d=e._cookieJar;return d[t]=i,!0},e}();b._cookieJar={},b._cookieSupport={persisted:!0,session:!0},e.Cookies=b;var _=function(){function e(){}return e.addEvent=function(e,t,n){try{e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}catch(e){}},e.removeEvent=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},e.ready=function(e){var t=!1,n=!0,r=window,i=r.document,o=i.documentElement,a=i.addEventListener,s=a?"addEventListener":"attachEvent",c=a?"removeEventListener":"detachEvent",d=a?"":"on",u=function(n){"readystatechange"==n.type&&"complete"!=i.readyState||(("load"==n.type?r:i)[c](d+n.type,u,!1),!t&&(t=!0)&&e.call(r,n.type||n))},p=function(){try{o.doScroll("left")}catch(e){return void setTimeout(p,50)}u("poll")};if("complete"==i.readyState)e.call(r,"lazy");else{if(!a&&o.doScroll){try{n=!r.frameElement}catch(e){}n&&p()}i[s](d+"DOMContentLoaded",u,!1),i[s](d+"readystatechange",u,!1),r[s](d+"load",u,!1)}},e.preventDefault=function(e){e.preventDefault?e.preventDefault():window.event?window.event.returnValue=!1:e.returnValue=!1},e.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},e.isHidden=function(){return void 0===e._isHidden&&e._monitorHidden(),e._isHidden},e._monitorHidden=function(){var t="hidden",n=function(n){var r=!1,i=!0,o={focus:r,focusin:r,pageshow:r,blur:i,focusout:i,pagehide:i};n=n||window.event,n.type in o?e._isHidden=o[n.type]:e._isHidden=document[t]};t in document?document.addEventListener("visibilitychange",n):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(t="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?document.onfocusin=document.onfocusout=n:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=n,n({type:"visible"===document.visibilityState?"focus":"blur"})},e.generateGuid=function(){if(!e._rng){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)try{var n=new Uint8Array(16);e._rng=function(){return t.getRandomValues(n),Array.prototype.slice.call(n)}}catch(e){}if(!e._rng){var r=new Array(16);e._rng=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}}var i=e._rng();i[6]=15&i[6]|64,i[8]=63&i[8]|128;for(var o="",a=0;a<i.length;a++)o+=(i[a]+256).toString(16).substr(1);return o.substring(0,8)+"-"+o.substring(8,12)+"-"+o.substring(12,16)+"-"+o.substring(16,20)+"-"+o.substring(20,32)},e.generateRandomId=function(){return(e.getTimeInTicks()+Math.floor(1e4*Math.random()+1)).toString(36)},e.getTimeInTicks=function(){return 1*new Date},e.trim=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},e.extend=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=Array.prototype.slice.call(arguments,1),i=0;i<r.length;i++)if(r[i])for(var o in r[i])e[o]=r[i][o];return e},e.getSD=function(){var t=e.getSDName(),n=window[t];return n||e.error("Utils::getSD - "+t+" not found."),n},e.getSDName=function(){var e=window.ShiftAnalyticsObject||"sd";return e},e.getSDQueue=function(){var t=e.getSD(),n=null;return t&&((n=t.q)||(n=t.q=[])),n},e.getArgs=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r={};e=Array.prototype.slice.call(e||[],0);var i={};"object"==typeof e[e.length-1]&&(i=e[e.length-1],e=e.slice(0,e.length-1));for(var o=0;o<t.length;o++)r[t[o]]=i[t[o]]||e[o];return r},e.debug=function(e){t.debug&&console&&console.log&&console.log(n.debugPrefix+e)},e.error=function(e,t){console&&console.error&&(t?console.error(n.errorPrefix+e,t):console.error(n.errorPrefix+e))},e.getQueryParams=function(e){for(var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},o=[window.location.search.substring(1),window.location.hash.substring(1)],a={},s=0;s<o.length;s++)for(var c=o[s];t=r.exec(c);){var d=i(t[1]);e&&(d=e(d)),a[d]=i(t[2])}return a},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isDate=function(e){return e instanceof Date&&!isNaN(e.valueOf())},e.arrayIndexOf=function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},e.keys=function(e){if("object"==typeof e&&e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}return[]},e.attachSyncCommands=function(e){e.getLinkerUrl=function(t,n){var r="";return e.sync("getLinkerUrl",t,n,function(e){return r=e}),r},e.linkByPost=function(t,n){e.sync("linkByPost",t,n)},e.link=function(t,n){e.sync("link",t,n)}},e.addParamsToUrl=function(e,t,n){var r=document.createElement("a");if(r.href=e,t){var i=r.search;i=i?i+"&":"?",i+=t,r.search=i}if(n){var i=r.hash;i=i?i+"&":"#",i+=n,r.hash=i}return r.href},e.stringToBool=function(e){return e=e||"","Y1T".indexOf(e.toUpperCase().charAt(0))!==-1},e.uniqueArray=function(e){var t=[];if(e&&0!==e.length)for(var n=0;n<e.length;n++){for(var r=!1,i=0;i<t.length;i++)if(t[i]===e[n]){r=!0;break}r||t.push(e[n])}return t},e.flatten=function(t,n,r){var i={};if(t&&"object"==typeof t){var o=10;n=n||[],r=r||0,n.push(t);for(var a in t)if(t.hasOwnProperty(a)){var s=t[a],c=typeof s;if("function"===c&&(s=s(),c=typeof s),null!==s&&void 0!==s||(s=""),"number"===c&&isNaN(s)&&(s="0"),"object"===c){
if(e.isDate(s))i[a]=s.getTime().toString();else if(r+1<=o&&e.arrayIndexOf(n,s)===-1){var d=e.flatten(s,n,r+1);for(var u in d)d.hasOwnProperty(u)&&(i[a+"."+u]=d[u])}}else i[a]=s.toString()}}return i},e.diff=function(t,n){t=t||{},n=n||{};for(var r=e.keys(t).sort(),i=e.keys(n).sort(),o=[],a=[],s=[],c=0,d=0,u=r.length,p=i.length;c<u&&d<p;){var l=r[c],g=i[d],f=t[l],h=n[g];l<g?(a.push([l,f]),c++):l===g?(f!==h&&s.push([g,f,h]),c++,d++):(o.push([g,h]),d++)}for(;c<u;){var l=r[c],f=t[l];a.push([l,f]),c++}for(;d<p;){var g=i[d],h=n[g];o.push([g,h]),d++}return{adds:o,removes:a,changes:s}},e}();_._rng=null,e.Utils=_;var C=function(){function e(){}return e.escape=function(e){return e=(e||"")+"",e.replace(new RegExp("\\"+n.serializeEscapeChar,"g"),n.serializeEscapeChar+n.serializeEscapeChar)},e.unescape=function(e){return e.replace(new RegExp("\\"+n.serializeEscapeChar+"(.)","g"),"$1")},e.dictionaryToString=function(t){var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push(e.escape(i)+n.serializeEscapeChar+"2"+e.escape(t[i]));return r.join(n.serializeEscapeChar+"1")},e.stringToDictionary=function(t){var r={};if(t){var i=t.split(n.serializeEscapeChar+"1"),o=0;for(o=0;o<i.length;o++){var a=i[o].split(n.serializeEscapeChar+"2");if(2===a.length){var s=e.unescape(a[0]),c=e.unescape(a[1]);r[s]=c}}}return r},e}();e.Serializer=C;var k=function(){function e(){}return e.getProp=function(e,t){return e.props[t]},e.setProp=function(e,t,n){e.props[t]=n},e.getProps=function(e){var t=e.props;return e.props={},t},e}();e.Props=k;var I=function(){function e(){}return e.getEVar=function(e,t){return e.eVars[t]},e.setEVar=function(e,t,n){e.eVars[t]=n},e.getEVars=function(e){var t=e.eVars;return e.eVars={},t},e}();e.EVars=I}(_SD||(_SD={})),function(){var e="_SD::StartCount";if(window[e]=window[e]||0,window[e]++,1===window[e]){var t="ShiftAnalyticsObject";window[t]||(window[t]="sd");var n=_SD.Utils.getSDQueue(),r=_SD.Utils.getSDName(),i=null;for(window[r]=function(){i.sd(Array.prototype.slice.call(arguments))},i=new _SD.Loop;0!==n.length;){var o=n.shift();i.push(o)}i.sdSync();var a=_SD.Utils.getSD();_SD.Utils.attachSyncCommands(a)}else console&&console.error&&console.error("SD.js loaded more than once.")}();