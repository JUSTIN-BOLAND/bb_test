(function($){$.fn.dealerOnResponsiveModelBar=function(options){var defaults={mb:"",mainFolderPath:stockPhotoPath+"photo/",modelBarThumbnailFolder:"pixt320",modelBarPopUpFolder:"pixt320"};var options=$.extend(defaults,options);var o=options;var responsiveModelBarParams;var modelBarArr=[];var modelBarCustomButtonArr=[];var modelBarButtonArr=[];var modelBarButtonLabelArr=[];var modelBarThumbnailsArr=[];var uniqueIDs=new Array();var thumbnailElm;var modelBarStyle=0;var photoType="mbDb";var extItem={};var tagLine=false;var showPopUp=true;var modelBarTitle;var obj=$(this);if(o.mb!=""){responsiveModelBarParams=o.mb}modelBarArr=eval(responsiveModelBarParams.mb);modelBarCustomButtonArr=eval(responsiveModelBarParams.cmb);modelBarButtonArr=eval(responsiveModelBarParams.bt);modelBarButtonLabelArr=eval(responsiveModelBarParams.bl);modelBarThumbnailsArr=eval(responsiveModelBarParams.th);modelBarTitle=eval(responsiveModelBarParams.mbt);if(typeof(modelBarThumbnailsArr.act)!="undefined"){if(modelBarThumbnailsArr.act==1){tagLine=true}}if(typeof(modelBarThumbnailsArr.acp)!="undefined"){if(modelBarThumbnailsArr.acp==1){showPopUp=false}}var modelBarThumbnailWidthMD=100/modelBarThumbnailsArr.tw;var modelBarThumbnailWidthSM=100/modelBarThumbnailsArr.th;var modelBarThumbnailAngle=modelBarThumbnailsArr.ta;var modelBarPopUpAngle=modelBarThumbnailsArr.pa;var maxModelBarThumbnailWidth=Math.round((modelBarThumbnailWidthMD>=modelBarThumbnailWidthSM?1170*modelBarThumbnailWidthMD:749*modelBarThumbnailWidthSM)/100);var modelBarPopUpDirection;if(typeof(modelBarThumbnailsArr.pd)!="undefined"){switch(modelBarThumbnailsArr.pd){case 1:modelBarPopUpDirection="top";break;case 2:modelBarPopUpDirection="bottom";break;case 3:modelBarPopUpDirection="auto left";break;case 4:modelBarPopUpDirection="auto right";break;default:var modelBarPopUpDirection="auto top"}}if(typeof(modelBarThumbnailsArr.style)!="undefined"){modelBarStyle=modelBarThumbnailsArr.style}var buttonStart=modelBarButtonArr.tp;var buttonGap=modelBarButtonArr.sb;return this.each(function(){activateModelBar()});function activateModelBar(){thumbnailElm=$("#modelBarWidget");var mbPhotoThb;var mbPhotoPop;if(typeof(modelBarTitle)!="undefined"&&modelBarTitle.title!=""){thumbnailElm.prepend('<h2 class="h1 text-center margin-bottom_5x margin-top-x">'+modelBarTitle.title+"</h2>")}$("head").append("<style>@media (min-width:992px) { .col-model-thumb { width:"+modelBarThumbnailWidthMD+"%; float: left; } } @media (max-width:991px) { .col-model-thumb { width:"+modelBarThumbnailWidthSM+"%; float: left; } }</style>");$.each(modelBarCustomButtonArr,function(i,item){if(item.hasOwnProperty("first")&&item.first=="true"){thumbnailElm.append(buildCustomButtons(i,item));thumbnailElm.find("a").last().click(function(){window.location=item.url});modelBarStylePath(modelBarStyle)}});$.each(modelBarArr,function(i,item){extItem=modelBarExt(item);if(typeof(item.thuPhoto)!="undefined"){mbPhotoThb=item.thuPhoto;mbPhotoPop=item.popPhoto}if(typeof(item.type)!="undefined"){photoType=item.type}var mbThumbId="popover-"+validSelector(item.model);if($.inArray(mbThumbId,uniqueIDs)!=-1){mbThumbId=mbThumbId+uniqueIDs.length}uniqueIDs.push(mbThumbId);$("#modelBarWidget").addClass(modelBarThumbnailAngle);var vehAltTitle=item.year+" "+item.make+" "+extItem.mo;thumbnailElm.append(('<a id="'+mbThumbId+'" class="col-model-thumb vehicle text-center nopad" data-content="'+modelBarButtons(item,extItem)+modelBarMpg(item.mpg,1)+modelBarPhoto(mbPhotoPop,0,photoType)+modelBarTag(item.mpg,item.tag)+'"><div class="img-responsive carImage" role="img" id="'+validSelector(extItem.mo)+'" alt="vehAltTitle" title="vehAltTitle" style="background: url(\''+modelBarPhoto(mbPhotoThb,1,photoType)+"') no-repeat 50% 50% / contain; padding-top: 67.5%;\"></div>"+modelBarElmTitle(item.year,item.make,extItem.mo,0)+modelBarMpg(item.mpg,0)+"</a>").replace(/vehAltTitle/gi,vehAltTitle));if(showPopUp){if(jQuery.browser.mobile){$("#"+mbThumbId).popover({html:true,placement:"top"});$("#"+mbThumbId).popover("show");$("#"+mbThumbId).popover("hide");$("#"+mbThumbId).on("click",function(e){$(".col-model-thumb").not(this).popover("hide")})}else{$("#"+mbThumbId).popover({placement:modelBarPopUpDirection,trigger:"manual",html:true,animation:false}).on("mouseenter",function(){var _this=this;$(_this).popover("show");$(this).siblings(".popover").on("mouseleave",function(){$(_this).popover("hide")})}).on("mouseleave",function(){var _this=this;setTimeout(function(){if(!$(".popover:hover").length){$(_this).popover("hide")}},50)}).parent().delegate("#"+item.year+item.make+item.model+"new,#"+item.year+item.make+item.model+"used,#"+item.year+item.make+item.model+"specials","click",function(){var currentSelection=this.id;if(currentSelection.indexOf("new")!=-1){DealerOnTrack.event("Model Bar Clicks",item.year+item.make+item.model,"New")}else{if(currentSelection.indexOf("used")!=-1){DealerOnTrack.event("Model Bar Clicks",item.year+item.make+item.model,"Used")}else{DealerOnTrack.event("Model Bar Clicks",item.year+item.make+item.model,"Specials")}}});$("#"+mbThumbId).popover("show");$("#"+mbThumbId).popover("hide")}}else{if(modelBarThumbnailsArr.ac==1){$("#"+mbThumbId).attr("href",ThumbnailClick(modelBarThumbnailsArr.url,item,extItem));$("#"+mbThumbId).click(function(e){DealerOnTrack.event("Model Bar Clicks",item.year+item.make+item.model,"Thumbnail Click")})}}});$.each(modelBarCustomButtonArr,function(i,item){if(!item.hasOwnProperty("first")||item.first=="false"){thumbnailElm.append(buildCustomButtons(i,item));thumbnailElm.find("a").last().click(function(){window.location=item.url});modelBarStylePath(modelBarStyle)}})}function buildCustomButtons(i,item){var modelBarCustomButtonHtml="";var buttonImage=item.img;if(buttonImage.indexOf("assets/")>-1){buttonImage=buttonImage.substr(buttonImage.indexOf("assets/"))}if(buttonImage.match(/\.gif$/i)==null){buttonImage=AssetsPath+"am/r/"+maxModelBarThumbnailWidth+"/"+buttonImage}else{buttonImage=AssetsPath+buttonImage}modelBarCustomButtonHtml='<a id="'+item.id+'" class="mbCustomBtn';if(!isEmpty(item.lbl)){modelBarCustomButtonHtml=modelBarCustomButtonHtml+' vehicle text-center col-model-thumb"><img class="img-responsive" src="'+buttonImage+'" alt="'+item.imgTitle+'" title="'+item.imgTitle+'" /><p class="mbThumbTitle"><span class = "customModelBar ttModel">'+item.lbl+"</span></p></a>"}else{modelBarCustomButtonHtml=modelBarCustomButtonHtml+' col-model-thumb"><div class="img-responsive carImage" role="img" style="background: url(\''+buttonImage+'\') no-repeat 50% 50% / contain; padding-top: 67.5%;" alt="'+item.imgTitle+'" title="'+item.imgTitle+'"></div></a>'}return modelBarCustomButtonHtml}function isEmpty(str){return(!str||0===str.length)}function modelBarStylePath(id){var url="/widgets-ajax.aspx?fa=modelbar_styles&s=s&mbid="+id;var path="";$.getJSON(url,function(response){path=response.path;if(path!=""){$("head").append('<link rel="stylesheet" href="'+path+'" />')}})}function modelBarButtons(v,ext){var html="";var newModel=v.model;var usedModel=v.model;var model=v.model;if(ext!=null){newModel=ext.nm;usedModel=ext.um}var filterNew="";var filterNUsed="";if(newModel!=""){filterNew="?make="+v.make+"&model="+newModel.URIencode()}if(usedModel!=""){filterNUsed="?make="+v.make+"&model="+usedModel.URIencode()}var link;$.each(modelBarButtonLabelArr,function(i,item){link=item.url;var newOrUsed="specials";if(item.lbl!=""){if(item.url.indexOf("searchnew")>0){link+=filterNew;newOrUsed="new"}else{if(item.url.indexOf("searchused")>0){link+=filterNUsed;newOrUsed="used"}}html+="<div class='col-sm-6'><a id='"+v.year+v.make+v.model+newOrUsed+"' class='btn btn-main btn-block btn-sm "+validSelector(item.lbl)+"'  href='"+link+"' >"+item.lbl+"</a></div>"}});html="<div class='row popoverTitle'>"+html+"</div>";html=modelBarElmTitle(v.year,v.make,model,1)+html;return html}function modelBarMpg(mpg,type){var html="";var gasEconomyLabel="MPG";if(typeof CanadianGasEconomyLabel!=="undefined"&&CanadianGasEconomyLabel==true){gasEconomyLabel="L/100 KM"}if(mpg!=0){if(type==1){html="<p class='ptMpg'><span class='ptMpgValue'>"+mpg+"&nbsp;</span><span class='ptMpgLabel'>"+gasEconomyLabel+"</span></p>"}else{html="<p class='ttMpg'><span class='ttMpgValue'>"+mpg+"&nbsp;</span><span class='ttMpgLabel'>"+gasEconomyLabel+"</span></p>"}}return html}function modelBarElmTitle(year,make,model,type){var html="";if(type==1){html="<strong><p class='mbPopUpTitle'><span class='ptYear'>"+year+"&nbsp;</span><span class='ptMake'>"+make+"&nbsp;</span><span class='ptModel'>"+model+"</span></p></strong>"}else{html="<p class='mbThumbTitle'><span class='ttYear'>"+year+"&nbsp;</span><span class='ttMake'>"+make+"&nbsp;</span><span class='ttModel'>"+model+"</span></p>"}return html}function modelBarPhoto(photo,thumb,type){var p="";if(thumb==1){p=photo.replace("sideview",modelBarThumbnailAngle);p=p.replace("pixt320",o.modelBarThumbnailFolder);if(type=="mbDb"){p=AssetsPath+"am/r/"+maxModelBarThumbnailWidth+"/photo/"+p}else{if(type=="mbCu"){if(p.indexOf("assets/")>-1){p=p.substr(p.indexOf("assets/"))}if(p.indexOf("pixt320/")>-1){p="/photo/"+p}p=AssetsPath+"am/r/"+maxModelBarThumbnailWidth+"/"+p}}}else{p=photo.replace("sideview",modelBarPopUpAngle);p=p.replace("pixt320",o.modelBarPopUpFolder);if(type=="mbDb"){p=AssetsPath+"am/r/"+244+"/photo/"+p}else{if(type=="mbCu"){if(p.indexOf("assets/")>-1){p=p.substr(p.indexOf("assets/"))}if(p.indexOf("pixt320/")>-1){p="/photo/"+p}p=AssetsPath+"am/r/"+244+"/"+p}}p="<img class='img-responsive popoverImage' height='111' src='"+p+"' alt='vehAltTitle' title='vehAltTitle'/>"}return p.toLowerCase()}function validSelector(v){return v.replace(/[^\w-]/g,"-")}function modelBarTag(mpg,tag){var line="";if(tagLine&&mpg!=0){line="<p class='popoverTag margin-bottom-x' style='display:block;'>"+tag+"</p>"}else{line="<p class='popoverTag margin-bottom-x' style='display:none;'>"+tag+"</p>"}return line}function modelBarExt(v){var ext=new Object();if(typeof(v.nm)!="undefined"){ext.nm=v.nm}else{ext.nm=v.model}if(typeof(v.um)!="undefined"){ext.um=v.um}else{ext.um=v.model}if(typeof(v.mo)!="undefined"){ext.mo=v.mo}else{ext.mo=v.model}if(typeof(v.tag)!="undefined"){ext.tag=v.tag}else{ext.tag=""}return ext}function ThumbnailClick(cUrl,v,ext){var newModel=v.model;var usedModel=v.model;var model=v.model;if(ext!=null){newModel=ext.nm;usedModel=ext.um}var filterNew="";var filterUsed="";if(newModel!=""){filterNew="?make="+v.make+"&model="+newModel.URIencode()}if(usedModel!=""){filterUsed="?make="+v.make+"&model="+usedModel.URIencode()}if(cUrl.indexOf("search")>-1){if(cUrl.indexOf("/")!=0){cUrl="/"+cUrl}if(cUrl.indexOf("used")>0){cUrl+=filterUsed}else{cUrl+=filterNew}}if(!window.DealeronCookie.hasItem("DLRON_coordinate")){return cUrl}if(sessionStorage.getItem("DLRON_coordinate_"+window.location.href+cUrl.split("?")[0].substring(1))==1){var location=trimLatLongCoordinate(window.DealeronCookie.getItem("DLRON_coordinate"));if(cUrl.indexOf("currentlocation")<0&&cUrl.indexOf("ZipCode")<0){if(cUrl.indexOf("?")===-1){cUrl+="?currentlocation="+location+"&st=Distance+asc,default"}else{cUrl+="&currentlocation="+location+"&st=Distance+asc,default"}}}return cUrl}}})(jQuery);String.prototype.URIencode=function(){if(this.length>0&&(this.indexOf("=")==-1)){return encodeURIComponent(this.trim().replace(/%26/g,"~-_")).replace(/%25/g,"%").replace(/%2C/g,",").replace(/%3D/g,"=").replace(/~-_/g,"%26").replace(/%20/g,"+")}else{if(this.indexOf("=")!=-1){return this.trim()}else{return encodeURIComponent(this)}}};$(document).ready(function(){if(typeof(responsiveModelBarParams)!="undefined"){$("#modelBarWidget").dealerOnResponsiveModelBar({mb:responsiveModelBarParams})}});