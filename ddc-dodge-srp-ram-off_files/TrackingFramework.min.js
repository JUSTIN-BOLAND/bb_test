"use strict";DDC.classes.namespace("tracking.framework.runtime"),tracking.framework.runtime.Page=function(e){this.dataLayerHelper=e},tracking.framework.runtime.Page.prototype={constructor:tracking.framework.runtime.Page,isNewVehiclePage:function(e){return e.indexOf("_NEW")>-1},isCertifiedUsedVehiclePage:function(e){return e.indexOf("_CERTIFIED_USED")>-1},isUsedVehiclePage:function(e){return e.indexOf("_USED")>-1},isIndexPage:function(e){return"INDEX"===e},isVehicleListingPage:function(e){return e.indexOf("INVENTORY_LISTING")>-1},isVehicleDetailPage:function(e){return 0==e.indexOf("AUTO_")&&e.indexOf("_DETAILS")>-1},isIncentivesPage:function(e){return e.indexOf("INCENTIVES")>-1},isHoursOrDirectionsPage:function(e){return e.indexOf("HOURS")>-1||e.indexOf("DIRECTIONS")>-1},dataLayerProperty:function(e){return this.dataLayerHelper.get(e)},currentPageAlias:function(){return this.dataLayerProperty("page.pageInfo.pageName")},widgetIsPresent:function(e){var t=this.dataLayerProperty("page.pageInfo.pageWidgets");for(var i in t)if(e.test(t[i]))return!0;return!1},queryFacetIsPresent:function(e){for(var t in e)if(e.hasOwnProperty(t)&&void 0!==e[t])return!0;return!1}},DDC.classes.namespace("tracking.framework.runtime"),tracking.framework.runtime.Command=function(e,t){this.log=com.dealer.log.Logger.createFor(this),this.window=e,this.page=t},tracking.framework.runtime.Command.prototype={constructor:tracking.framework.runtime.Command,logCategory:"Command",execute:function(){}},DDC.classes.namespace("tracking.framework.runtime"),tracking.framework.runtime.EventHandler=function(e,t){this.log=com.dealer.log.Logger.createFor(this),this.window=e,this.page=t},tracking.framework.runtime.EventHandler.prototype={constructor:tracking.framework.runtime.EventHandler,logCategory:"EventHandler",handlePageView:function(){},handleSlideshowClick:function(){},handleTypedSearch:function(){},handleFormInitiation:function(){},handleFormSubmission:function(){},handleClickToCall:function(){},handleOfferClick:function(){},handleFilterSearch:function(){},handleMapClick:function(){}},DDC.classes.namespace("tracking.framework.runtime"),tracking.framework.runtime.EventHandlerDecorator=function(e,t,i){tracking.framework.runtime.EventHandler.call(this,e,t),this.delegate=i},DDC.classes.extend(tracking.framework.runtime.EventHandlerDecorator,tracking.framework.runtime.EventHandler),tracking.framework.runtime.EventHandlerDecorator.prototype.logCategory="EventHandlerDecorator",tracking.framework.runtime.EventHandlerDecorator.prototype.handlePageView=function(e){this.delegate.handlePageView(e)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleSlideshowClick=function(e,t){this.delegate.handleSlideshowClick(e,t)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleTypedSearch=function(e,t){this.delegate.handleTypedSearch(e,t)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleFormInitiation=function(e){this.delegate.handleFormInitiation(e)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleFormSubmission=function(e,t){this.delegate.handleFormSubmission(e,t)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleClickToCall=function(e){this.delegate.handleClickToCall(e)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleOfferClick=function(e,t){this.delegate.handleOfferClick(e,t)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleFilterSearch=function(e,t){this.delegate.handleFilterSearch(e,t)},tracking.framework.runtime.EventHandlerDecorator.prototype.handleMapClick=function(){this.delegate.handleMapClick()},DDC.classes.namespace("tracking.framework.runtime"),tracking.framework.runtime.InteractionListener=function(e,t,i){this.log=new com.dealer.log.Logger("InteractionListener"),this.window=e,this.page=t,this.eventHandler=i},tracking.framework.runtime.InteractionListener.prototype={constructor:tracking.framework.runtime.InteractionListener,onDataPushed:function(e,t){switch(t.event){case"ddc.page.view":this.log.info("Handling page view event"),this.eventHandler.handlePageView(t.eventData.alias);break;case"ddc.inventory.filterSearch":this.log.info("Handling filter search event"),this.eventHandler.handleFilterSearch(t.eventData.resultCount,t.eventData.queryFacets);break;case"ddc.slideshow.click":this.log.info("Handling slideshow click event"),this.eventHandler.handleSlideshowClick(t.eventData.position,t.eventData.name);break;case"ddc.form.typedSearch":this.log.info("Handling typed search event"),this.eventHandler.handleTypedSearch(t.eventData.trackingId,t.eventData.typedSearchContent);break;case"ddc.form.initiation":this.log.info("Handling form initiation event"),this.eventHandler.handleFormInitiation(t.eventData.trackingId);break;case"ddc.form.submission":this.log.info("Handling form submission event"),this.eventHandler.handleFormSubmission(t.eventData.trackingId,t.eventData.validate);break;case"ddc.link.clickToCall":this.log.info("Handling click to call event"),this.eventHandler.handleClickToCall(t.eventData.clickToCallDepartment);break;case"ddc.link.offerClick":this.log.info("Handling offer click event"),this.eventHandler.handleOfferClick(t.eventData.offerId,t.eventData.offerName);break;case"ddc.maps":this.log.info("Handling map click event"),this.eventHandler.handleMapClick()}},initialize:function(){var e=this;this.log.info("listening to DataLayer events"),new DataLayerHelper(this.window.dataLayer,function(t,i){e.onDataPushed(t,i)},!0)}},DDC.classes.namespace("tracking.framework.commands"),tracking.framework.commands.TriggerFilterSearch=function(e,t){tracking.framework.runtime.Command.call(this,e,t)},DDC.classes.extend(tracking.framework.commands.TriggerFilterSearch,tracking.framework.runtime.Command),tracking.framework.commands.TriggerFilterSearch.prototype.logCategory="TriggerFilterSearch",tracking.framework.commands.TriggerFilterSearch.prototype.execute=function(){var e=this.page.dataLayerProperty("page.attributes.vehicleResultCount");if(e>=0){var t=this.page.dataLayerProperty("page.queryFacets");if(t){var i=this.page.currentPageAlias();(this.page.queryFacetIsPresent(t)||this.page.isVehicleListingPage(i)||this.page.widgetIsPresent(/\.inventory-listing\.(?!blank)/))&&(this.log.info("publishing inventory filter search event"),this.window.dataLayer.push({event:"ddc.inventory.filterSearch",eventData:{resultCount:e,queryFacets:t}}))}}},DDC.classes.namespace("tracking.framework.commands"),tracking.framework.commands.TriggerPageView=function(e,t){tracking.framework.runtime.Command.call(this,e,t)},DDC.classes.extend(tracking.framework.commands.TriggerPageView,tracking.framework.runtime.Command),tracking.framework.commands.TriggerPageView.prototype.logCategory="TriggerPageView",tracking.framework.commands.TriggerPageView.prototype.execute=function(){this.log.info("publishing page view event"),this.window.dataLayer.push({event:"ddc.page.view",eventData:{alias:this.page.currentPageAlias()}})},DDC.classes.namespace("tracking.framework.config"),tracking.framework.config.Injector=function(){this.log=new com.dealer.log.Logger("Injector")},tracking.framework.config.Injector.prototype={constructor:tracking.framework.config.Injector,capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1)},decapitalize:function(e){return e.charAt(0).toLowerCase()+e.substring(1)},setterFor:function(e,t){var i="set"+this.capitalize(t);return e[i]},setProperties:function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r=this.setterFor(e,i);void 0!==r?(this.log.isDebugEnabled()&&this.log.debug("using setter injection to set "+i+" to: "+JSON.stringify(n)),r.call(e,n)):(this.log.isDebugEnabled()&&this.log.debug("using field injection to set "+i+" to: "+JSON.stringify(n)),e[i]=n)}return e},initialize:function(e,t,i){if(t=void 0===t?"initialize":t,i=void 0===i?!1:i,void 0!==e[t]&&"function"==typeof e[t])this.log.debug("invoking "+t+"()"),e[t].call(e);else{if(i)throw new Error("Initializer not found: "+t+"()");this.log.debug("initializer not found: "+t+"()")}return e}},tracking.framework.config.Injector.singleton=new tracking.framework.config.Injector,tracking.framework.config.Injector.get=function(){return tracking.framework.config.Injector.singleton},DDC.classes.namespace("tracking.framework.config"),tracking.framework.config.Component=function(e,t){this.log=new com.dealer.log.Logger("Component"),this.injector=tracking.framework.config.Injector.get(),this.definition=e||{},this.defaults=t||{}},tracking.framework.config.Component.prototype={constructor:tracking.framework.config.Component,withDefinition:function(e,t){return this.definition=e||{},this.defaults=t||{},this},className:function(){if(void 0!==this.definition.className)return this.definition.className;if(void 0!==this.defaults.className)return this.defaults.className;throw new Error("Failed to determine class from component definition")},properties:function(){return void 0!==this.definition.properties?this.definition.properties:void 0!==this.defaults.properties?this.defaults.properties:void 0},initializer:function(){return void 0!==this.definition.initializer?this.definition.initializer:void 0!==this.defaults.initializer?this.defaults.initializer:void 0},instantiate:function(e,t,i){i=void 0===i?!1:i;var n=this.className();this.log.debug("instantiating "+n);var r=t.call(e,DDC.classes.resolve(n)),a=this.properties();void 0!==a&&(this.log.debug("injecting configured properties into "+n),this.injector.setProperties(r,a));var o=this.initializer();return(i||void 0!==o)&&(this.log.debug("attempting to invoke "+n+"."+o+"()"),this.injector.initialize(r,o,i)),r}},DDC.classes.namespace("tracking.framework.config"),tracking.framework.config.RuntimeBuilder=function(e,t){this.log=new com.dealer.log.Logger("RuntimeBuilder"),this.component=new tracking.framework.config.Component,this.window=e,this.configuration=t},tracking.framework.config.RuntimeBuilder.prototype={constructor:tracking.framework.config.RuntimeBuilder,buildDataLayer:function(){this.log.debug("building data layer..."),this.window.dataLayer=this.window.dataLayer||[this.window.DDC.dataLayer],this.log.debug("data layer built.")},buildPage:function(){this.log.debug("building page...");var e=this.component.withDefinition(this.configuration.page,{className:"tracking.framework.runtime.Page"}).instantiate(this,function(e){return new e(new DataLayerHelper(this.window.dataLayer))},!1);return this.log.debug("page built."),e},buildEventHandler:function(e){this.log.debug("building event handler...");var t=this.component.withDefinition(this.configuration.eventHandler,{initializer:"initialize"}).instantiate(this,function(t){return new t(this.window,e)},!1);return this.log.debug("event handler built."),t},buildDecoratorChain:function(e,t){if(this.log.debug("building decorator chain..."),void 0!==this.configuration.decorators)for(var i=this.configuration.decorators.length-1;i>=0;i--)t=this.component.withDefinition(this.configuration.decorators[i],void 0).instantiate(this,function(i){return new i(this.window,e,t)},!1);return this.log.debug("decorator chain built."),t},buildInteractionListener:function(e,t){this.log.debug("building interaction listener...");var i=this.component.withDefinition(this.configuration.interactionListener,{className:"tracking.framework.runtime.InteractionListener",initializer:"initialize"}).instantiate(this,function(i){return new i(this.window,e,t)},!0);return this.log.debug("interaction listener built."),i},buildStartupCommands:function(e){var t=[];if(this.log.debug("building startup commands..."),void 0!==this.configuration.startupCommands)for(var i=0;i<this.configuration.startupCommands.length;i++)t.push(this.component.withDefinition(this.configuration.startupCommands[i],void 0).instantiate(this,function(t){return new t(this.window,e)},!1));return this.log.debug("startup commands built..."),t}},DDC.classes.namespace("tracking.framework.config"),tracking.framework.config.Main=function(e){this.log=new com.dealer.log.Logger("Main"),this.builder=e,this.page=void 0,this.eventHandler=void 0,this.decoratorChain=void 0,this.listener=void 0},tracking.framework.config.Main.prototype={constructor:tracking.framework.config.Main,assembleRuntimeComponents:function(){this.log.debug("assembling runtime components..."),this.builder.buildDataLayer(),this.page=this.builder.buildPage(),this.eventHandler=this.builder.buildEventHandler(this.page),this.decoratorChain=this.builder.buildDecoratorChain(this.page,this.eventHandler),this.listener=this.builder.buildInteractionListener(this.page,this.decoratorChain),this.log.debug("runtime components assembled.")},executeStartupCommands:function(){var e=this.builder.buildStartupCommands(this.page);if(void 0!==e&&e.length>0){this.log.debug("executing startup commands...");for(var t=0;t<e.length;t++){var i=e[t];i.execute()}this.log.debug("startup commands executed.")}},execute:function(){this.assembleRuntimeComponents(),this.executeStartupCommands()}};