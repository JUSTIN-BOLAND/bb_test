!function(e,t){"use strict";var n,i=t.siteSettings.pageAlias,a=e("html"),r=i.indexOf("INVENTORY_LISTING")>-1?!0:!1,o=0===i.indexOf("AUTO")?!0:!1,d=i.indexOf("INVENTORY_COMPARE")>-1?!0:!1,c=0===i.indexOf("CONFIRM")?!0:!1,l="tier-one-build-and-price",p=a.data("preferred")||!1,s=e("html[data-preferred=true]"),f=a.find(".preferred-vehicles-container"),m=f.find(".ddc-dropdown.dropdown"),u=(s.find('[data-widget-id*="confirm"]'),JSON.parse(localStorage.getItem("pvData"))||""),v=u.make||"",b=u.model||"",_=u.trim||"",h=u.sourceDomain||"",g=f.find(".preferred-list").data("tracking-ids"),k=!0,w={desktop:{mycarsVDP:".mycars-vdp",preferredVehicleSave:".mycars-save-btn",preferredVehicleAlert:".mycars-add-alert-btn"},mobile:{mycarsVDP:".mycars-buttons",preferredVehicleSave:".mycars-saved-btn",preferredVehicleAlert:".price-alert"}},y={},D=function(e){return e&&e.length>0},I=function(){if(t.UDS){if(t.isComposer===!0)return!0;t.UDS.getLatestPreferredVehicle(function(t){if(t){var n=t.make||"",i=t.model||"",a=t.trim||"",r=t.sourceDomain||"";u&&b==t.model||(u={make:n,model:i,trim:a,sourceDomain:r},localStorage.setItem("pvData",JSON.stringify(u)),m.addClass("open")),D(n)&&D(i)&&x(n,i,a,r)}else t||(u={},null===localStorage.getItem("pvData")&&e(window).on("load",function(){A("bp_no_match","bp_hide",0)}),localStorage.setItem("pvData",JSON.stringify(u)))})}},x=function(i,c,s,u){var v=e(".preferred-vehicles-container .ajax-navigation-element"),_={make:i,model:c,trim:s,appId:t.UDS.appId},h=t.addUrlParams(v.data("fragment-url"),e.param(_));v.hasClass("ajax-load-complete")||e.ajax({url:h}).done(function(e){v.html(e)}).complete(function(){if(e(".pv-list").data("inventory-item-count")>0){var t=m.find(".pv-info");a.addClass(l),f.removeClass("hide"),v.addClass("ajax-load-complete").css("visibility","visible"),S(t,i,c,u),m.find(".pv-vehicle a").on("click",function(t){t.preventDefault(),n=e(this).attr("href"),A("bp_menu","bp_menu_vehicle_link",void 0,n)}),m.find(".pv-list-cta").on("click",function(t){t.preventDefault(),n=e(this).attr("href"),A("bp_menu","bp_menu_vlp_link",void 0,n)}),((r||o)&&p||d)&&(C(t.data("make"),t.data("model")),O(),U())}else b!=c&&A("bp_no_match","bp_hide",0)})},S=function(e,n,i,a){var r=m.find(".pv-info-matches"),o=m.find(".pv-info-model"),d=m.find(".pv-info-source-domain"),c=m.find(".pv-list"),l=c.data("inventory-item-count"),p=m.find(".pv-btn-count"),s=1!==l?"SIMILAR_VEHICLES":"SIMILAR_VEHICLE";r.text(l+" "+t.i18n.getLabel(s).toLowerCase()),o.text(e.data("make")+" "+e.data("model")),d.text(a),p.text(l),b!=i&&A("bp_match","bp_expose",l)},C=function(n,i){var a=e(".inventoryList .item"),c=a.find(".hproduct"),l=e(y.mycarsVDP),p=l.find(y.preferredVehicleSave),s=l.find(y.preferredVehicleAlert);r&&(a.each(function(){var a=e(this),r=e.getDataAttributes(a),o=a.find(".mycars-save-btn"),d=a.find(".mycars-add-alert-btn"),c=a.find('[data-eprice="true"],[data-href*="eprice-form.htm"]'),l=c.data("href"),p=t.addUrlParam(l,"preferred",!0),s=P(n,r.make,i,r.model);s&&(a.find("a").each(function(){V(e(this),"vlp")}),c.attr("data-href",p),o.on("click",function(){A("bp_vlp","bp_vlp_vehicle_save")}),d.on("click",function(){A("bp_vlp","bp_vlp_vehicle_alert")}))}),c.on("hproductClick",function(){var t=e(this).closest(".item"),a=e.getDataAttributes(t),r=P(n,a.make,i,a.model);r&&A("bp_vlp","bp_vlp_vehicle_link")})),o&&(p.on("click",function(){A("bp_vdp","bp_vdp_vehicle_save")}),s.on("click",function(){A("bp_vdp","bp_vdp_vehicle_alert")})),d&&e(".compareItems .title-name").each(function(){var t=e(this),a=e.getDataAttributes(t),r=P(n,a.make,i,a.model);if(r){var o=t.closest('td[class^="col-"]').attr("class"),d=e("."+o).find("a:not(.remove)");d.each(function(){V(e(this),"compare")})}})},P=function(e,t,n,i){return e==t&&n==i?!0:!1},V=function(e,n){var i=e.attr("href"),a=t.addUrlParam(i,"preferred",!0),r=e.attr("target");"#"!=i&&""!==i&&void 0!==i&&(e.attr("href",a),e.on("click",function(e){e.preventDefault(),A("bp_"+n,"bp_"+n+"_vehicle_link",void 0,a,r)}))},O=function(){s.on("submit",function(){var n,i,a="submit"==e(document.activeElement).attr("type")?e(document.activeElement).closest("form"):e(document.activeElement).find("form"),d=a.attr("action"),c=a.hasClass("facetmulti-form")||"compareForm"==a.attr("id")||a.parent().hasClass("inventory-search-form");-1!==d.indexOf("preferred=true")||c||void 0==d||(r?(n="vlp",i=t.addUrlParam(d,"referringPage",n)):o&&(n="vdp",i=t.addUrlParams(d,"preferred=true&referringPage="+n)),a.attr("action",i))})},U=function(){var t="bp_vdp,bp_vdp_lead";e.subscribe("dr-trade-complete",function(){A(t)}),e.subscribe("dr-payment-complete",function(){A(t)}),e.subscribe("dr-finance-complete",function(){A(t)}),e.subscribe("dr-finance-complete",function(){A(t)}),e.subscribe("dr-prequal-complete",function(){A(t)}),e.subscribe("dr-reserve-complete",function(){A(t)}),e.subscribe("dr-protect-complete",function(){A(t)})},A=function(t,n,i,a,r){var o={widgetName:"build_price_results",eventName:t,data:n,value:i,trackerIds:[g]};if("undefined"!=typeof a){{"_blank"==r?window.open(a,"_blank"):window.open(a,"_self")}o.hitCallback=function(){}}"bp_expose"===n&&(o.dimensionIndex=1,o.dimensionValue=t+" "+n+" "+i),e(document).trigger("trackEvent",[o])};e(document).ready(function(){y=t.client.isMobile?w.mobile:w.desktop,I(),t.client.isMobile?(m.on("click",function(){k=!1,x(v,b,_,h),A("bp_menu","bp_menu_expose")}),e(document).on("slideClose",function(){k===!1&&(k=!0,A("bp_menu","bp_menu_hide"))})):(m.on("show.bs.dropdown",function(){e(this).find(".ddc-dropdown-menu").first().stop(!0,!0).slideDown()}),m.on("hide.bs.dropdown",function(){e(this).find(".ddc-dropdown-menu").first().stop(!0,!0).slideUp()}),m.on("shown.bs.dropdown",function(){x(v,b,_,h),A("bp_menu","bp_menu_expose")}),m.on("hidden.bs.dropdown",function(){A("bp_menu","bp_menu_hide")})),f.find(".ddc-dropdown-menu").on("click",function(e){e.stopPropagation()}),c&&p&&e(window).on("load",function(){A("bp_"+t.getUrlParams().referringPage,"bp_"+t.getUrlParams().referringPage+"_lead")})})}(jQuery,window.DDC);