!function(){var e=this,a=e.jQuery,t=e.DDC,n={number:/^-?[0-9]*\.?[0-9]*/g,parentheticalNumber:/\(-?[0-9]*\.?[0-9]*\)/g},l={calculateSelector:".calculate",calculatorPrice:"[name=price]",calculatorIncentiveTypes:"[name=incentiveTypes]",calculatorMonthlyPayment:"[name=monthlypayment]",calculationPrice:"[name=calculationPrice]",dialog:".dialog",pricing:".pricing",price:".pricing strong.price",childPrice:"strong.price",pleaseCall:".please-call",span:"span",monthlyPayment:"li.monthlyPayment",dealertrackCalculateLink:".calculate-dealertrack",personalizePaymentsButton:'a[data-name="calculator.payment.dealertrack"]'},i={abSub:"abSub",discount:"discount",hide:"hide",rebate:"rebate"},r={page:{calculatorSelect:"calculator-select",calculated:"calculated.payment"},user:{calculateClick:"click",personalizePaymentClick:"click",personalizePaymentHover:"hover"}},c={user:{live:{calculateClick:l.calculateSelector},traditional:{personalizePaymentClick:l.personalizePaymentsButton,personalizePaymentHover:l.personalizePaymentsButton}}},o=function(e,a){var t=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return a?t(a):t},s=function(e){var t=e?a.trim(e.toString().replace(/[$,]/g,"")).match(n.number):"";return t=t&&t[0]?parseFloat(t[0]):0},d={paymentInfo:o('<strong><%= i18n.getLabel("YOUR_ESTIMATED_MONTHLY_PAYMENT") %>:</strong><br /><strong class="h2"><%= formattedPayment %></strong> <span class="perMonthLabel"><%= i18n.getLabel("PER_MONTH")%> <%= i18n.getLabel("PLUS_TAXES") %>  <%= i18n.getLabel("PLUS_SALES_TAXES") %></span> <p><%= !isNaN(period) && (period > 84) ? period / 12 + " " + i18n.getLabel("YEARS") : (!isNaN(period) ? period + " " + i18n.getLabel("MONTHS") : "") %> @ <%= apr %>% <%= i18n.getLabel("APR") %><% if (cashTrade && formattedCashTrade) { %><br /> (<%= formattedCashTrade %> <%= i18n.getLabel("DOWN_PAYMENT") %>)<% } %></p>')},p={page:{calculatorSelect:function(){a(document).trigger("dialog",[{name:"calculator.payment"}])},calculated:function(e,n){n&&(n.payment||0===n.payment)&&n.period&&(n.apr||0===n.apr)&&(n.formattedPayment=t.format.currency(Math.ceil(n.payment))||"$0",n.formattedCashTrade=t.format.currency(Math.ceil(n.cashTrade)),a(l.monthlyPayment).html(d.paymentInfo(a.extend({},n,t))).next("li").andSelf().removeClass(i.hide))}},user:{calculateClick:function(){return a(document).trigger(r.page.calculatorSelect),!1},personalizePaymentClick:function(){var e,n=a(this),l=n.attr("data-href"),i=a("div#payment-calc-target"),r=".payment-calc-close",c=1e3;return 0===i.html().length||0!==i.find(".confirm-default").length?(i.find(".payment-calculator-verbiage").slideUp(c),e=a('<i class="ddc-icon ddc-icon-animate-spin ddc-icon-loading"></i>'),a(this).prepend(e),a.get(l,function(n){a("body").animate({scrollTop:i.offset().top-140},c/4,function(){a.publish("paymentdriver.ready")}),i.empty().html(n).slideDown(c,function(){e.remove(),i.on("click",r,function(e){i.slideUp(c,function(){0===i.find("form").length&&i.empty()}),e.preventDefault()})}),"undefined"!=typeof t.modules.popover&&a(document).trigger("modulesRefresh",{modules:{popover:t.modules.popover}})})):i.slideDown(c,function(){a("body").animate({scrollTop:i.offset().top-120},c/4,function(){a.publish("paymentdriver.show")})}),!1}}},u={disableCalculatorFields:function(){a(l.calculatorPrice).add(l.calculatorMonthlyPayment).attr("disabled","disabled").addClass("ui-state-disabled")},calculatorReset:function(){setTimeout(function(){a(l.calculatorPrice).change()},750)},dealertrackCalculatorPrep:function(){var e,n=a(l.dealertrackCalculateLink);n.length>0&&(t.paymentCalculatorPresets&&t.paymentCalculatorPresets.price&&(e=s(t.paymentCalculatorPresets.price),e>0&&!n.hasClass("calculate-dealertrack-disable")&&n.closest("li").removeClass("hide")),n.one("mouseover",function(){a('<div id="payment-calc-target" class="hide"></div>').insertAfter(".content-page-title")}))},initPaymentDisclaimer:function(){a(".payment-calculator-pro-info-disclaimer").appendTo(".content-disclaimer:first").addClass("xsmall").show(),a('span[data-id="payment_info_trigger"]').popover({html:!0,trigger:"hover",content:function(){var e=a("script#payment-disclaimer-loan-verbiage"),t=a("script#payment-disclaimer-lease-verbiage"),n=a("script#payment-disclaimer-vdp-verbiage"),l="";l+=n.html(),e.length>0&&(l+=e.html()),t.length>0&&(l+=t.html());var i=_.template(l),r=a(this).parent();if(""!==r.data("program-end-date"))var c=new Date(r.data("program-end-date")),o=c.getUTCMonth()+1+"/"+c.getUTCDate()+"/"+c.getUTCFullYear();var s={downPayment:r.data("downpayment"),APR:r.data("apr"),term:r.data("term"),leaseTerm:r.data("lease-term"),leaseSecurityDeposit:r.data("lease-security-deposit"),leaseDueAtSigning:r.data("lease-due-at-signing"),excessMileCharge:r.data("excess-mile-charge"),annualMiles:r.data("annual-miles"),programEndDate:"undefined"!=typeof o?"through "+o:r.data("no-lease-end-date-verbiage"),lenderLegalName:r.data("lender-legal-name"),leaseLenderLegalName:r.data("lease-lender-legal-name"),loanCreditScore:r.data("loan-credit-score"),leaseCreditScore:r.data("lease-credit-score"),monthlyPaymentPerThousand:r.data("monthly-payment-per-thousand"),acquisitionFee:r.data("acquisition-fee"),capCostTotal:r.data("cap-cost-total"),capCostReduction:r.data("cap-cost-reduction"),monthlyPayment:r.data("monthly-payment"),totalMonthlyPayments:r.data("total-monthly-payments")};return i(s)}})}};!function(){var e,n,r,c=null,o=[],d="";for(var p in i)o.push(i[p]);a.map(o,function(e,a){d+=a!=o.length-1?e+"|":e});var u=new RegExp("([w_-]+?("+d+")|("+d+")+?[w_-]+|("+d+"))","gi");""!==a(l.calculatorIncentiveTypes).val()&&(n=a(l.calculatorIncentiveTypes).val()),"undefined"==typeof n&&(n=""),"automatic"!==a(l.calculationPrice).val()&&""!==a(l.calculationPrice).val()&&(r=a(l.pricing).find("."+a(l.calculationPrice).val()).find(l.childPrice).text(),s(r)>0&&(c=r)),(null===c||void 0===c)&&a(l.price).each(function(){a(this).parent(l.span).size()>0&&(a(this).parent(l.span).attr("class").match(u)||(s(a(this).text())&&(e=a(this).text()),null===c||void 0===c?c=e:null!==c&&void 0!==c&&(-1!==n.indexOf("CASH_OR_APR")?s(e)>s(c)&&(c=e):s(e)<s(c)&&(c=e))))}),t.paymentCalculatorPresets=a.extend(t.paymentCalculatorPresets,{price:c}),void 0!==c&&a(l.calculatorPrice).attr("value",c)}(),a(function(){a.each(r.page,function(e){a(document).bind(r.page[e],p.page[e])}),a.each(c.user.live,function(e){a(c.user.live[e]).die(r.user[e]).live(r.user[e],p.user[e])}),a.each(c.user.traditional,function(e){a(c.user.traditional[e]).unbind(r.user[e]).bind(r.user[e],p.user[e])}),a.each(u,function(e){a.isFunction(u[e])&&u[e]()})})}();