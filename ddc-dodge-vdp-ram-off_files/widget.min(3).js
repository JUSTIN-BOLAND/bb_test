!function(){var e=this,t=e.jQuery,a=e.DDC,r=a.paymentCalculatorPresets,n={number:/^-?[0-9]*\.?[0-9]*/g},i={form:".calculator-payment form",price:"[name=price]",cashTrade:"[name=cash_trade]",rate:"[name=rate]",term:"[name=term]",maxTerm:"[name=maxTerm]",interval:"[name=interval]",selectedTerm:"[name=selectedTerm]",customTerms:"[name=customTerms]",monthlypayment:"[name=monthlypayment]",costOfBorrowing:"[name=costOfBorrowing]",paymentCalculatorUrl:"[name=paymentCalculatorUrl]",reset:".calculator-payment button[type=reset]:visible",selectRebates:"[name=selectrebates]",alertInfo:".calculator-payment p"},o=[i.price,i.cashTrade,i.rate,i.term,i.monthlypayment,i.costOfBorrowing],c={page:{calculate:"calculate.payment",calculated:"calculated.payment",reset:"reset.payment"},user:{fieldChange:"change",fieldKeypress:"keypress",fieldKeyup:"keyup",resetClick:"click"}},l={user:{live:{resetClick:i.reset},traditional:{fieldChange:[i.price,i.cashTrade,i.rate,i.term,i.selectRebates].join(","),fieldKeypress:[i.price,i.cashTrade,i.rate,i.term].join(","),fieldKeyup:[i.price,i.cashTrade,i.rate,i.term].join(",")}}},s=function(e,t,a){var r,n=t/1200;return r=n?(n+n/(Math.pow(1+n,a)-1))*e:e/a,r=!isNaN(r)&&r>0?Math.round(r):0},m=function(e,t,a){var r=e*t-a;return r>0?r:0},u=function(e){return Math.max.apply(this,e)>180},d=function(e,t,r){var n,i,o,c=[],l=(t.slice().join("%,")+"%").split(","),m=a.i18n.getLabel(u(r)?"YEARS":"MONTHS"),d=u(r)?12:1;for(l.splice(0,0,""),i=0;i<r.length;i++){for(n=[r[i]/d],o=0;o<t.length;o++)n.push(Math.ceil(s(e,t[o],r[i])));c.push(n)}return{rows:c,columns:l,periodsLabel:m}},p=function(e){var a=e?t.trim(e.toString().replace(/[$,]/g,"")).match(n.number):"";return a=a&&a[0]?parseFloat(a[0]):0},f=function(e,t){var a=p(e),r=p(t);return e&&-1!==e.toString().indexOf("%")&&(a=r*(a/100)),a},h=function(e,t,a){var r,n=[];for(r=e;t>=r;r+=a||1)n.push(r);return n},g={page:{calculate:function(e,a){var r,n,i;!a.amount&&0!==a.amount||!a.apr&&0!==+a.apr||!a.period||(t("input:checked[name='selectrebates']").size()&&(a.amount=a.amount-parseInt(t("input:checked[name='selectrebates']").val().split("_").pop(),10)),n=s(a.amount,a.apr,a.period),r=m(n,a.period,a.amount),i=d(a.amount,h(a.apr,a.apr+3),t(a.form).data("initialTerms")||[a.period]),t(document).trigger(c.page.calculated,[t.extend(a,{payment:n,cost:r,series:i})]))},calculated:function(e,r){var n=r.form||i.form;r=t.extend({formattedPrice:a.format.currency(r.price),formattedCashTrade:a.format.currency(Math.ceil(r.cashTrade)),formattedPayment:a.format.currency(Math.ceil(r.payment))||"$0",formattedCost:a.format.currency(Math.ceil(r.cost))||"$0",paymentField:r.paymentField||t(i.monthlypayment,n),costField:r.costField||t(i.costOfBorrowing,n),paymentCalculatorUrlField:t(i.paymentCalculatorUrl,n),integerPrice:Math.ceil(r.price)},r),(r.payment||0===r.payment)&&(t(r.paymentField,n).val(r.formattedPayment),r.cashTrade&&-1!==t(i.cashTrade,n).val().indexOf("%")&&t(i.cashTrade,n).val(r.formattedCashTrade),t(r.paymentCalculatorUrlField).size()&&(r.paymentCalculatorUrl=t("option",r.paymentCalculatorUrlField).eq(t(r.paymentCalculatorUrlField)[0].selectedIndex).attr("data-action")),t(document).trigger("dynamicUrls",[r]),r.userChangeEvent&&t(document).trigger("trackEvent",[{widgetName:"payment-calculator",eventName:"calculate",data:"price: "+r.formattedPrice+", down payment: "+r.formattedCashTrade+", APR: "+r.apr+"%, , term (months): "+r.period+", payment: "+r.formattedPayment,value:Math.ceil(r.payment)}])),t(i.costOfBorrowing).length>0&&((r.cost||0===r.cost)&&t(r.costField,n).val(r.formattedCost),t(i.alertInfo).find("span.subDown").html(r.formattedCashTrade).end().find("span.subApr").html(r.apr).end().find("span.subTerm").html(r.period).end().find("span.subCost").html(r.formattedCost))},reset:function(e,a){var r=a.form||i.form;t(o).each(function(e,a){t(a,r).val(t(a,r).data("initial"))}),t(i.price,r).trigger("change")}},user:{fieldChange:function(e){var r=t(this).parents(i.form),n=t(this).val();t(this).data("last",n),setTimeout(function(){var n=p(t(i.price,r).val()),o=f(t(i.cashTrade,r).val(),n);o>n&&(o=n);var l={price:n,amount:n-o,cashTrade:o,rawCashTrade:p(t(i.cashTrade,r).val()),apr:p(t(i.rate,r).val()),period:p(t(i.term,r).val()),form:r,userChangeEvent:!!e.originalEvent};t(document).trigger(c.page.calculate,[l]),t(i.cashTrade,r).val(a.format.currency(parseInt(o,10)))},1)},fieldKeypress:function(e){0!==e.which&&t(this).trigger(c.user.fieldChange)},fieldKeyup:function(e){8===e.which&&t(this).trigger(c.user.fieldChange)},resetClick:function(e){var a=t(this).parents(i.form);t(document).trigger(c.page.reset,[{form:a}]),e.preventDefault()}}},y={termsPopulate:function(){var e=function(e,r,n){var i,o,c=t(r).empty()[0],l=a.i18n.getLabel(u(e)?"YEARS":"MONTHS"),s=u(e)?12:1;for(i=0;i<e.length;i++)o=e[i]/s+" "+l,c.options[c.options.length]=new Option(o,e[i]),e[i]===n&&(c.selectedIndex=i)};t(i.form).each(function(){var a=p(t(i.maxTerm,this).val()),n=p(t(i.interval,this).val()),o=p(t(i.selectedTerm,this).val()),c=t(i.customTerms,this).val(),l=[];l=c?t.map(c.split(","),function(e){return p(e)}):h(n,a,n),r&&r.term&&(o=r.term,-1===l.indexOf(r.term)&&l.push(r.term)),l.sort(function(e,t){return e-t}),t(this).data("initialTerms",l),e(l,t(i.term,this),p(o))})},storeInitialValues:function(){t(i.form).each(function(){var e=this;t(o).each(function(a,n){var i=t(n,e),o=t(i).attr("name"),c=t(i).val()||r&&r[o];t(i).data("initial",c)})})},initialUrls:function(){var e,r,n,o={},c=/\|([\w]*)\|/g;t(i.paymentCalculatorUrl).each(function(){if(r=t("option",this).eq(t(this)[0].selectedIndex).attr("data-action"),n=r.match(c)){for(e=0;e<n.length;e++)o[n[e].replace(/\|/g,"")]="";r=a.evaluateTokenString(r,o)}t(document).trigger("dynamicUrls",[o]),t(document).trigger("dynamicUrls",[{paymentCalculatorUrl:r}])})},reset:function(){t(i.form).each(function(){t(document).trigger(c.page.reset,[{form:this}])})},disableCalculatorFields:function(){t(i.form+" "+i.monthlypayment).attr("disabled","disabled"),t(i.form+" "+i.costOfBorrowing).attr("disabled","disabled").addClass("ui-state-disabled")},rebind:function(){bindTraditionalHandlers()}};bindTraditionalHandlers=function(){t.each(l.user.traditional,function(e){t(l.user.traditional[e]).unbind(c.user[e]).bind(c.user[e],g.user[e])})},t(function(){t.each(c.page,function(e){t(document).bind(c.page[e],g.page[e])}),t.each(l.user.live,function(e){t(l.user.live[e]).die(c.user[e]).live(c.user[e],g.user[e])}),bindTraditionalHandlers(),setTimeout(function(){t.each(y,function(e){t.isFunction(y[e])&&y[e]()})},500)})}();