var DIShiftDigital={isShortCode:!1,isVRP:!1,isVDP:!1,hasErrors:!1,errorMessage:"",activelyBoundForms:{},isConsoleLogEmitting:!0,isFormLeadStarted:!1,leadFormOmniEventFired:!1,anyEventFired:!1,init:function(){sdGlobalVars.environment.includes("production")&&(this.isConsoleLogEmitting=!1),this.console_log("di-sd start init"),"undefined"!=typeof sd&&sd("create",sdGlobalVars.clientId,sdGlobalVars.dealerCode,"DealerInspire"),this.initGlobalVars(),this.initPageVars(),"undefined"!=typeof shiftDigitalShortcode?(this.isShortCode=!0,this.handleShortCode()):"undefined"!=typeof window.updateVDPViewCount?(this.isVDP=!0,this.handleVDP()):"undefined"!=typeof DealerInspireInventory&&"undefined"!=typeof DealerInspireInventory.options&&"undefined"!=typeof DealerInspireInventory.options.shortcode?(this.isVRP=!0,this.handleVRP()):this.firePageLoadEvent(),this.initBindings(),this.handleQueryStringParams(),this.bindToForms(),jQuery(document).on("im_lead_start",function(a){DIShiftDigital.handleFormActivatedEvent(a)}),this.console_log("di-sd end init")},initGlobalVars:function(){var a=sdGlobalVars;this.console_log(a);for(key in a)this.console_log(key+" : "+typeof a[key]),"string"==typeof a[key]&&a[key].length>=1?(sdDataLayer[key]=a[key],this.console_log("set sdDataLayer."+key+" as "+a[key])):this.console_log("not setting sdDataLayer."+key+' as it is undefined, null, or ""')},isTrafficBookmarked:function(a,b){return""==a||a==b},isTrafficPaidSearch:function(a,b,c){return null!=(a.match("[?&]utm_[a-zA-Z0-9]+")||b.match("[?&]aclk")||b.match("[?&]gclid")||c.match("doubleclick.net"))},isTrafficOrganic:function(a){return null!=a.match("google.(com|ca)|bing.com|yahoo.com|ask.com|aol.com|mywebsearch.com|lycos.com|dogpile.com|infospace.com|search.com|excite.com|altavista.com")},getTrafficType:function(){var a=document.createElement("a");return a.href=document.referrer,this.isTrafficPaidSearch(window.location.search,a.search,a.hostname)?"Paid Search":this.isTrafficBookmarked(a.hostname,window.location.hostname)?"Typed/Bookmarked":this.isTrafficOrganic(a.hostname)?"Organic Search":"Other"},getCurrentTrafficType:function(){var a=60,b=this.readCookie("sdTrafficType");if(null!=b)return this.createCookie("sdTrafficType",b,a),b;var c=this.getTrafficType();return this.createCookie("sdTrafficType",c,a),c},initPageVars:function(){if(this.console_log("start initpagevars"),"undefined"!=typeof sdPageVars.page_vars){var a=sdPageVars.page_vars;this.console_log(a),sdDataLayer.trafficType=this.getCurrentTrafficType(),this.console_log("sd Traffic Type: "+sdDataLayer.trafficType);for(key in a)this.console_log(key+" : "+typeof a[key]),"string"==typeof a[key]&&a[key].length>=1?(sdDataLayer[key]=a[key],this.console_log("set sdDataLayer."+key+" as "+a[key])):this.console_log("not setting sdDataLayer."+key+' as it is undefined, null, or ""')}this.console_log("end initpagevars")},initBindings:function(){jQuery('a[href^="tel:"]').bind("click touchstart",function(){DIShiftDigital.handleClickToCallEvent(this)}),jQuery(".flexslider-hg-wrapper").bind("click touchstart",function(a){a.stopPropagation(),DIShiftDigital.console_log("clicked on carousel"),DIShiftDigital.handleCarouselClickEvent(a)}),jQuery("input#search-anything-field").bind("click touchstart blur",function(a){DIShiftDigital.handleSearchAnythingEvent(a)}),jQuery("input#search.inventory-search-field").bind("click touchstart blur",function(a){DIShiftDigital.handleSearchAnythingEvent(a)}),jQuery("input#alg-search").bind("click touchstart blur",function(a){DIShiftDigital.handleSearchAnythingEvent(a)}),jQuery("a[href='#specialOffersModal']").bind("click",function(a){DIShiftDigital.handleSpecialsLinkClickEvent(a,jQuery(this))}),jQuery("div.offerbuttonbar>a.cta-button").bind("click",function(a){DIShiftDigital.handleSpecialsLinkClickEvent(a,jQuery(this))})},bindToForms:function(){this.console_log("start bindToForms");for(formId in sdGlobalVars.gforms)!function(a){if(sdPageVars.gforms[a]instanceof Object)if(jQuery("#gravity-form-"+a).length||jQuery("#gform_"+a).length){var b=jQuery("form#gform_"+a);jQuery("input[type=submit]",b);"undefined"!=typeof this.activelyBoundForms[a]?this.console_log("form "+a+" is already bound!"):(this.console_log("form "+a+" is not bound. binding..."),this.activelyBoundForms[a]=!0,this.console_log("Form ID : "+a+" is present. Binding.")),b.find("input").focus(function(b){0==this.isFormLeadStarted||"undefined"==typeof this.isFormLeadStarted?(DIShiftDigital.console_log("isFormLeadStarted is false. Setting to true to prevent duplicated start events."),this.isFormLeadStarted=!0,DIShiftDigital.console_log("Firing lead start event for form "+a),DIShiftDigital.leadStartEvent(a)):DIShiftDigital.console_log("form "+a+" was clicked; however, a lead has already been started.")})}else this.console_log("form "+a+" is not on this page.")}(formId);this.console_log("end bindToForms")},handleQueryStringParams:function(){this.console_log("start handleQueryStringParams");var a=this.getQueryStringAsObj(),b={};for(key in a)if("string"==typeof a[key]&&key.match(/sd/)){var c=key.replace(/sd_/,"");b[c]=a[key].replace(/\+/g," "),"formId"==c&&void 0!==typeof b[c]&&(b.formType=this.remapFormParams(b[c])),DIShiftDigital.console_log("discovered Shift Digital Query String param: "+key+" : "+a[key])}this.console_log(b.length);var e,d=0;for(e in b)b.hasOwnProperty(e)&&d++;d>0&&(this.setMappedParams(b),this.fireAJAXEvent(),this.console_log(b)),this.console_log("end handleQueryStringParams")},remapFormParams:function(a){switch(parseInt(a)){case 1:return"Get A Quote";case 2:return"Parts";case 3:return"General Contact";case 4:return"General Contact";case 5:return"Parts";case 6:return"Service";case 7:return"Test Drive";case 8:return"Vehicle Finder";case 9:return"Service";case 10:return"Vehicle Finder";case 11:return"Employment";case 12:return"Service";case 13:return"Trade In"}return"Dealer Custom"},handleClickToCallEvent:function(a){var b={clickToCallDepartment:"Sales",events:"clickToCall"};return DIShiftDigital.setMappedParams(b),DIShiftDigital.fireAJAXEvent(),!1},handleCarouselClickEvent:function(a){var b={carouselClick:{assetPosition:jQuery(".flex-active-slide").find("div.slide").attr("id"),assetName:jQuery(".flex-active-slide div.slide-data").text()},events:"carouselClick"};return DIShiftDigital.setMappedParams(b),DIShiftDigital.fireAJAXEvent(),!1},handleSearchAnythingEvent:function(a){var b="";"undefined"!=typeof jQuery("input#search-anything-field").val()&&(b=jQuery("input#search-anything-field").val()),"undefined"!=typeof jQuery("input#alg-search").val()&&(b=jQuery("input#alg-search").val()),"undefined"!=typeof jQuery("input#search.inventory-search-field").val()&&(b=jQuery("input#search.inventory-search-field").val());var c={typedSearch:{query:b},typedSearchContent:b,events:"typedSearch"};DIShiftDigital.setMappedParams(c),DIShiftDigital.fireAJAXEvent()},handleSpecialsLinkClickEvent:function(a,b){var c={offerClick:{offerId:"na",offerName:jQuery(b).parentsUntil("ul").find("h2").text()},events:"offerClick"};DIShiftDigital.setMappedParams(c),DIShiftDigital.fireAJAXEvent()},handleFormActivatedEvent:function(a){this.console_log("start handleFormActivatedEvent"),a?this.console_log("A form button was clicked."):this.console_log("Form button was not clicked."),this.console_log("end formActivatedEvent")},handleAjaxFormSubmittedEvent:function(a,b){var c=this.remapFormParams(b);if(this.console_log("start handleAjaxFormSubmittedEvent"),a)if(c)if(b){var d={leadId:a,formType:c,formId:b,events:"formSubmission"};this.setMappedParams(d),this.fireAJAXEvent(),this.console_log(d)}else this.console_log("Shift Digital handleAjaxFormSubmittedEvent missing formId!");else this.console_log("Shift Digital handleAjaxFormSubmittedEvent missing formType!");else this.console_log("Shift Digital handleAjaxFormSubmittedEvent missing leadId!");this.console_log("end handleAjaxFormSubmittedEvent")},handleShortCode:function(){this.console_log("start handleShortCode"),this.isShortCode||this.isShortCode===!0?(this.console_log("This page has a shortcode present."),this.setMappedParams(window.shiftDigitalShortcode),"undefined"!=typeof window.shiftDigitalShortcode.is_lead_complete?(DIShiftDigital.console_log("handleshortcode is a lead complete event. Aborting page load event and submitting AJAX only."),this.leadCompleteEventAsShortcode(window.shiftDigitalShortcode.lead_type,window.shiftDigitalShortcode.lead_name)):(DIShiftDigital.console_log("handleshortcode requesting pageload event fire"),this.firePageLoadEvent(),DIShiftDigital.console_log("handleshortcode finished requesting pageload event fire"))):this.console_log("This page does not have a shortcode present."),this.console_log("end handleShortCode")},handleVDP:function(){if(this.console_log("start handleVDP"),this.isVDP||this.isVDP===!0){this.console_log("This page is a VDP."),DIShiftDigital.console_log("executing vrp-ajax-complete binding from this.handleVRP");var a=DIShiftDigital.getVDPParamsAsMappedParams();a.pageType="Vehicle Details",this.setMappedParams(a),DIShiftDigital.console_log("finished vrp-ajax-complete binding event handler"),jQuery(document).on("click",".button-form,a",function(a){DIShiftDigital.console_log("clicked VDP form button")}),jQuery(document).on("click","#gf_better_than_internet_pricing_form",function(a){DIShiftDigital.console_log("clicked VDP form button")}),this.firePageLoadEvent()}else this.console_log("This page does not appear to be a VDP.");this.console_log("end handleVDP")},handleVRP:function(){if(this.console_log("start handleVRP"),this.isVRP||this.isVRP===!0){this.console_log("This page is a VRP.");var a=DIShiftDigital.getVRPParamsAsMappedParams();a.pageType="Vehicle Listing",this.anyEventFired===!1&&(DIShiftDigital.setMappedParams(a),this.firePageLoadEvent()),jQuery(document).on("vrp-ajax-complete",function(a){DIShiftDigital.console_log("executing vrp-ajax-complete binding from this.handleVRP");var b=DIShiftDigital.getVRPParamsAsMappedParams();b.pageType="Vehicle Listing",this.anyEventFired!==!1&&(DIShiftDigital.console_log(b),"undefined"==typeof b.props&&"object"!=typeof b.filterSearch||(DIShiftDigital.setMappedParams(b),DIShiftDigital.fireAJAXEvent()),DIShiftDigital.console_log("finished vrp-ajax-complete binding event handler"))})}else this.console_log("This page does not appear to be a VRP.");this.console_log("end handleVRP")},leadStartEvent:function(a){var b=this.getFormParamsFromFormId(a);this.console_log("form Params: "+b),b.prop64=this.getFormIdToLeadType(a),b.eVar64=this.getFormIdToLeadType(a),b.prop6=this.getFormIdToLeadName(a),b.eVar6=this.getFormIdToLeadName(a),b.events=this.getLeadEventNumber(DIShiftDigital.getFormIdToLeadType(a),!1),this.setMappedParams(DIShiftDigital.transposeParamsToOmnitureParams(b)),this.fireAJAXEvent()},leadCompleteEventAsShortcode:function(a){this.console_log("start leadCompleteEventAsShortcode. ");var b=window.shiftDigitalShortcode;"undefined"!=typeof b.lead_name&&delete b.lead_name,"undefined"!=typeof b.lead_type&&delete b.lead_type,this.console_log("form Params: "+b),b.events=this.getLeadEventNumber(a,!0),this.setMappedParams(DIShiftDigital.transposeParamsToOmnitureParams(b)),this.fireAJAXEvent(""),this.console_log("end leadCompleteEventAsShortCode")},getFormParamsFromFormId:function(a){var b={};for(varName in sdPageVars.gforms[a])b[varName]=jQuery("#input_"+a+"_"+sdPageVars.gforms[a][varName]).val();return this.console_log(b),b},getFormIdToLeadType:function(a){if("undefined"!=typeof sdPageVars.gforms_options_map&&"undefined"!=typeof sdPageVars.gforms_options_map[a]&&"undefined"!=typeof sdPageVars.gforms_options_map[a].lead_type)return this.console_log("received "+a+" as input. returning lead_type from options mapping"),sdPageVars.gforms_options_map[a].lead_type},getVDPParamsAsMappedParams:function(){this.console_log("start getVDPParamsAsMappedParams");var a={pageType:"Vehicle Details",vehicleDetails:{}},b={make:{name:"make",label:"Inventory Brand",description:"scion, toyota"},model:{name:"model",label:"Inventory Model",description:"xb,iq,fr-s,tc,xd,all"},year:{name:"year",label:"Inventory Year",description:"2010,2013,all"},type:{name:"status",label:"Inventory Type",description:"new,used,certified,all"},ext_color:{name:"exteriorColor",label:"Inventory color - mfr provided",description:"red,blue,green"},ext_color_generic:{name:"exteriorColor",label:"Inventory color simple",description:"red,blue,green"},int_color:{name:"interiorColor",label:"interior color",description:"the color inside the vehicle"},msrp:{name:"msrp",label:"MSRP",description:"Manufacturer Suggested Retail Price"},our_price:{name:"displayedPrice",label:"our price",description:"dealer advertised internet price"},engine_description:{name:"engine",label:"engine description",description:"engine description"},transmission_description:{name:"transmission",label:"transmission type",description:"the transmission type"},vin:{name:"vin",label:"Vehicle Identification Number",description:"unique vehicle identifier"}};for(var c in sdPageVars.vdp_data){var d=c.replace(/\[\]/g,"");"undefined"!=typeof b[d]&&(a.vehicleDetails[b[d].name]=sdPageVars.vdp_data[c])}return this.console_log(a),this.console_log("returning "+JSON.stringify(a)+" from getVDPParamsAsMappedValues"),a},getVRPParamsAsMappedParams:function(){function h(a){if("string"!=typeof a)var a=toString(a);return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}this.console_log("start getVRPParamsAsMappedParams");var a=jQuery(".filters-action-header .total-found .count").text(),b={countSearchResults:a,events:"filterSearch",filterSearch:{}},c={search:{name:"terms",label:"Search term",description:"what the user types into the search box"},bodytype:{name:"bodyStyle",label:"Body Type",description:"sedan,coupe, etc"},features:{name:"features",label:"Features",description:"things like AWD"},price:{name:"priceRange",label:"Price Range",description:"the price range(s) that an individual is/are interested in looking at"},make:{name:"make",label:"Inventory Brand",description:"scion, toyota"},model:{name:"model",label:"Inventory Model",description:"xb,iq,fr-s,tc,xd,all"},type:{name:"status",label:"Inventory Type",description:"new,used,certified,all"},ext_color_generic:{name:"color",label:"Inventory color",description:"red,blue,green"},year:{name:"year",label:"Year",description:"2016|2015"},trim:{name:"trim",label:"trim option",description:"ex,lx"}},d=DealerInspireInventory.options.shortcode;for(var e in d){this.console_log(e);var f=e.replace(/\[\]/g,"");"undefined"!=typeof c[f]&&"object"!=typeof d[e]?b.filterSearch[c[f].name]=d[e]:"object"==typeof d[e]&&"undefined"!=typeof c[f]&&(b.filterSearch[c[f].name]=d[e].join("|"))}var d=DealerInspireInventory.url_params;for(var e in d){this.console_log(e);var f=e.replace(/\[\]/g,"");"undefined"!=typeof c[f]&&"object"!=typeof d[e]?b.filterSearch[c[f].name]=d[e]:"object"==typeof d[e]&&"undefined"!=typeof c[f]&&(b.filterSearch[c[f].name]=d[e].join("|"))}for(var e in c){var g=c[e].name;if("undefined"==typeof b.filterSearch[g])b.filterSearch[g]="all","make"==g&&(b.filterSearch[g]=h(sdGlobalVars.defaultMake)),"status"==g&&(b.filterSearch[g]="Mixed");else if("status"==g){var i=/Certified Used/g;b.filterSearch[g]=b.filterSearch[g].replace(i,"CPO")}}if("undefined"!=typeof DealerInspireInventory.num_rows&&(b.countSearchResults=DealerInspireInventory.num_rows),"string"==typeof b.filterSearch.priceRange){var l,m,k=(toString(b.priceRange),b.filterSearch.priceRange.split("|"));for(var n in k){var o=k[n].split("-"),p="undefined"!=typeof o[0]?o[0]:null,q="undefined"!=typeof o[1]?o[1]:null;l=null==l||p<l?p:l,m=null==m||q>m?q:m,delete b.priceRange}}return b.filterSearch.minPrice=0,"null"!=typeof l&&(b.filterSearch.minPrice=l),"null"!=typeof m&&(b.filterSearch.maxPrice=m),this.console_log("returning "+JSON.stringify(b)+" from getVRPParamsAsMappedValues"),b},setMappedParams:function(a){this.console_log("Start set params");for(var b in a)"undefined"!=typeof window.sdDataLayer?"undefined"!=typeof a[b]||"null"!=typeof a[b]||""!=a[b]?(window.sdDataLayer[b]=a[b],this.console_log("set sdDataLayer."+b+" as "+a[b])):this.console_log("not setting sdDataLayer."+b+' as it is undefined, null, or ""'):this.console_log("setMappedParams - sdDataLayer is not defined.");this.console_log("end set params")},fireAJAXEvent:function(a){this.console_log("Start firing Shift Digital AJAX event"),this.anyEventFired=!0,"undefined"!=typeof sd?sd("send"):this.console_log("Shift Digital remote Library is undefined!"),this.console_log("Finish Firing Shift Digital AJAX event")},firePageLoadEvent:function(){this.console_log("Start firing sd page load event"),"undefined"!=typeof sd?(this.anyEventFired=!0,sd("send","pageview")):this.console_log("Shift Digital remote library is undefined!"),"undefined"==typeof window.sdDataLayer.pageType&&(window.sdDataLayer.pageType="Custom Dealer Content"),this.console_log("Finish firing sd page load event")},getQueryStringAsObj:function(){if("undefined"!=typeof window.location.search&&window.location.search.length>=1){var a=window.location.search.substring(1);return JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return{}},createCookie:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+60*c*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},eraseCookie:function(a){this.createCookie(a,"",-1)},console_log:function(a){if("undefined"==typeof this.isConsoleLogEmitting||0==this.isConsoleLogEmitting)return!1;var b=!1;if("undefined"==typeof console||"undefined"==typeof console.log){if(console={},!b)return!1;console.log=function(a){alert(a)}}else console.log(a)}};jQuery(document).ready(function(){try{DIShiftDigital.init()}catch(a){DIShiftDigital.console_log("DIShiftDigital exception ..."+a)}});